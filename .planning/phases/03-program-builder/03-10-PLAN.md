---
phase: 03-program-builder
plan: 10
type: execute
wave: 5
depends_on: ["03-08", "03-09"]
files_modified:
  - apps/coach-web/src/lib/api/programs.ts
  - apps/coach-web/src/routes/_authenticated/$orgSlug/programs/index.tsx
  - apps/coach-web/src/routes/_authenticated/$orgSlug/programs/new.tsx
  - apps/coach-web/src/components/programs/program-card.tsx
  - apps/coach-web/src/components/programs/program-form.tsx
autonomous: true

must_haves:
  truths:
    - "Programs list page shows all programs with search and filter"
    - "New program page creates program with name and optional athlete"
    - "Programs can be created from templates"
    - "API hooks use oRPC + TanStack Query patterns"
  artifacts:
    - path: "apps/coach-web/src/lib/api/programs.ts"
      provides: "Program API hooks"
      exports: ["usePrograms", "useCreateProgram", "useDuplicateProgram"]
    - path: "apps/coach-web/src/routes/_authenticated/$orgSlug/programs/index.tsx"
      provides: "Programs list page"
    - path: "apps/coach-web/src/routes/_authenticated/$orgSlug/programs/new.tsx"
      provides: "Create program page"
  key_links:
    - from: "apps/coach-web/src/routes/_authenticated/$orgSlug/programs/index.tsx"
      to: "apps/coach-web/src/lib/api/programs.ts"
      via: "usePrograms hook"
      pattern: "usePrograms"
---

<objective>
Create the programs list and creation pages with API hooks.

Purpose: Enable coaches to view and create programs before building the grid editor.
Output: Programs list, creation form, and API integration.
</objective>

<execution_context>
@/Users/tomiardz/.claude/get-shit-done/workflows/execute-plan.md
@/Users/tomiardz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/03-program-builder/03-08-SUMMARY.md
@.planning/phases/03-program-builder/03-09-SUMMARY.md
@apps/coach-web/src/lib/api/exercises.ts
@apps/coach-web/src/routes/_authenticated/$orgSlug/athletes.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create program API hooks</name>
  <files>apps/coach-web/src/lib/api/programs.ts</files>
  <action>
Create API hooks following established patterns from exercises.ts:

```typescript
import { orpc } from './client'
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'

// List programs with filters
export function usePrograms(filters?: {
  athleteId?: string
  isTemplate?: boolean
  status?: 'draft' | 'active' | 'archived'
  search?: string
  page?: number
  pageSize?: number
}) {
  return useQuery(orpc.programs.list.queryOptions({
    input: filters ?? {},
  }))
}

// Get program with full details (for grid editor)
export function useProgram(programId: string) {
  return useQuery(orpc.programs.get.queryOptions({
    input: { id: programId },
  }))
}

// Create program
export function useCreateProgram() {
  const queryClient = useQueryClient()

  return useMutation({
    ...orpc.programs.create.mutationOptions(),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: orpc.programs.key() })
    },
  })
}

// Duplicate program
export function useDuplicateProgram() {
  const queryClient = useQueryClient()

  return useMutation({
    ...orpc.programs.duplicate.mutationOptions(),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: orpc.programs.key() })
    },
  })
}

// Archive program
export function useArchiveProgram() {
  const queryClient = useQueryClient()

  return useMutation({
    ...orpc.programs.archive.mutationOptions(),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: orpc.programs.key() })
    },
  })
}
```
  </action>
  <verify>pnpm typecheck in apps/coach-web</verify>
  <done>Program API hooks created</done>
</task>

<task type="auto">
  <name>Task 2: Create programs list and new program pages</name>
  <files>
    apps/coach-web/src/routes/_authenticated/$orgSlug/programs/index.tsx
    apps/coach-web/src/routes/_authenticated/$orgSlug/programs/new.tsx
    apps/coach-web/src/components/programs/program-card.tsx
    apps/coach-web/src/components/programs/program-form.tsx
  </files>
  <action>
**Programs list page (index.tsx):**
- Route: /$orgSlug/programs
- Display programs in card grid (not table - programs are visual objects)
- Filters: search by name, filter by status (draft/active/archived), toggle templates
- Empty state with CTA to create first program
- Each card shows: name, athlete name (if assigned), status badge, week count, last updated
- Card actions: Edit (opens grid), Duplicate, Archive
- "Crear Programa" button in header

**New program page (new.tsx):**
- Route: /$orgSlug/programs/new
- Form fields:
  - Name (required, 3-100 chars)
  - Description (optional, max 500 chars)
  - Athlete selector (optional - uses existing athlete combobox pattern)
  - Template selector (optional - create from existing template)
- If template selected, use duplicateProgram mutation instead of create
- On success, navigate to program editor: /$orgSlug/programs/$programId

**Program card component (program-card.tsx):**
- Card with program info
- Status badge (Borrador/Activo/Archivado)
- Athlete avatar if assigned
- Week count pill
- Dropdown menu for actions

**Program form component (program-form.tsx):**
- React Hook Form + zodResolver
- Field component for consistent styling
- Athlete combobox (optional, from existing patterns)
- Template combobox (optional, fetches templates via usePrograms({ isTemplate: true }))
  </action>
  <verify>pnpm dev:coach - pages render without errors</verify>
  <done>Programs list and creation pages implemented</done>
</task>

</tasks>

<verification>
1. Run `pnpm typecheck` - frontend code type-checks
2. Run `pnpm dev:coach` - navigate to /programs
3. Verify list shows programs with filters
4. Verify new program form creates and redirects to editor
</verification>

<success_criteria>
- Programs list shows all organization programs
- Filters work: search, status, templates toggle
- Create program form validates and submits
- On create success, navigates to editor page
</success_criteria>

<output>
After completion, create `.planning/phases/03-program-builder/03-10-SUMMARY.md`
</output>
