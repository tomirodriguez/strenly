---
phase: 03-program-builder
plan: 12
type: execute
wave: 6
depends_on: ["03-10", "03-11"]
files_modified:
  - apps/coach-web/src/routes/_authenticated/$orgSlug/programs/$programId.tsx
  - apps/coach-web/src/components/programs/program-header.tsx
  - apps/coach-web/src/components/programs/week-column-header.tsx
  - apps/coach-web/src/components/programs/session-row.tsx
  - apps/coach-web/src/components/programs/exercise-row.tsx
  - apps/coach-web/src/styles/program-grid.css
autonomous: true

must_haves:
  truths:
    - "Program editor page shows full grid with all weeks and sessions"
    - "Session headers span full width with day name"
    - "Week column headers allow renaming and actions (duplicate, delete)"
    - "Superset exercises show visual connector line"
  artifacts:
    - path: "apps/coach-web/src/routes/_authenticated/$orgSlug/programs/$programId.tsx"
      provides: "Program editor page with grid"
      min_lines: 50
    - path: "apps/coach-web/src/styles/program-grid.css"
      provides: "Grid-specific styles including superset lines"
  key_links:
    - from: "apps/coach-web/src/routes/_authenticated/$orgSlug/programs/$programId.tsx"
      to: "apps/coach-web/src/components/programs/program-grid.tsx"
      via: "component import"
      pattern: "ProgramGrid"
---

<objective>
Create the program editor page that assembles the grid with headers and styling.

Purpose: Deliver the full Excel-like editing experience for coaches.
Output: Program editor page with grid, week headers, session rows, and superset styling.
</objective>

<execution_context>
@/Users/tomiardz/.claude/get-shit-done/workflows/execute-plan.md
@/Users/tomiardz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/03-program-builder/03-RESEARCH.md
@.planning/phases/03-program-builder/03-10-SUMMARY.md
@.planning/phases/03-program-builder/03-11-SUMMARY.md
@.planning/phases/03-program-builder/ui-ux-specifications/code.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create program editor page</name>
  <files>apps/coach-web/src/routes/_authenticated/$orgSlug/programs/$programId.tsx</files>
  <action>
Create the program editor page:

```typescript
import { createFileRoute, useParams } from '@tanstack/react-router'
import { useProgram, useUpdateProgram } from '@/lib/api/programs'
import { ProgramGrid } from '@/components/programs/program-grid'
import { ProgramHeader } from '@/components/programs/program-header'
import { Skeleton } from '@/components/ui/skeleton'

export const Route = createFileRoute('/_authenticated/$orgSlug/programs/$programId')({
  component: ProgramEditorPage,
})

function ProgramEditorPage() {
  const { programId } = useParams({ from: '/_authenticated/$orgSlug/programs/$programId' })
  const { data: program, isLoading, error } = useProgram(programId)
  const updateProgram = useUpdateProgram()

  if (isLoading) {
    return <ProgramEditorSkeleton />
  }

  if (error || !program) {
    return <ProgramNotFound />
  }

  return (
    <div className="flex flex-col h-full">
      {/* Header with program name, status, actions */}
      <ProgramHeader
        program={program}
        onNameChange={(name) => updateProgram.mutate({ id: programId, name })}
        onActivate={() => /* activate mutation */}
        onExportPDF={() => /* future: PDF export */}
      />

      {/* Main grid - takes remaining height */}
      <div className="flex-1 overflow-hidden">
        <ProgramGrid programId={programId} />
      </div>

      {/* Footer with keyboard shortcuts help */}
      <ProgramFooter />
    </div>
  )
}

function ProgramEditorSkeleton() {
  return (
    <div className="flex flex-col h-full">
      <div className="h-16 border-b border-border flex items-center px-6">
        <Skeleton className="h-6 w-48" />
      </div>
      <div className="flex-1 p-4">
        <Skeleton className="h-full w-full" />
      </div>
    </div>
  )
}
```

Key features:
1. Full-height layout with flex
2. Header for program metadata and actions
3. Grid takes remaining space
4. Footer with keyboard shortcut hints (as shown in UI/UX mockup)
  </action>
  <verify>pnpm typecheck in apps/coach-web</verify>
  <done>Program editor page created with grid</done>
</task>

<task type="auto">
  <name>Task 2: Create grid sub-components</name>
  <files>
    apps/coach-web/src/components/programs/program-header.tsx
    apps/coach-web/src/components/programs/week-column-header.tsx
    apps/coach-web/src/components/programs/session-row.tsx
    apps/coach-web/src/components/programs/exercise-row.tsx
  </files>
  <action>
**Program header (program-header.tsx):**
```typescript
interface ProgramHeaderProps {
  program: Program
  onNameChange: (name: string) => void
  onActivate: () => void
  onExportPDF: () => void
}

export function ProgramHeader({ program, onNameChange, ... }: ProgramHeaderProps) {
  return (
    <header className="h-16 flex items-center justify-between px-6 border-b border-border">
      <div className="flex items-center gap-4">
        {/* Editable program name */}
        <h1 className="text-base font-semibold">{program.name}</h1>
        {/* Status badge */}
        <Badge variant={program.status}>{statusLabels[program.status]}</Badge>
        {/* Athlete name if assigned */}
        {program.athleteId && <span className="text-muted-foreground">â€¢ {program.athleteName}</span>}
      </div>
      <div className="flex items-center gap-3">
        {/* View toggle: Structure | Grid View | Analytics */}
        <ViewToggle />
        {/* Live sync indicator */}
        <LiveSyncIndicator />
        {/* Export PDF button */}
        <Button variant="outline" onClick={onExportPDF}>
          <Download className="mr-2 h-4 w-4" />
          Export PDF
        </Button>
        {/* Save/Activate button */}
        <Button onClick={onActivate}>
          <Save className="mr-2 h-4 w-4" />
          Guardar Programa
        </Button>
      </div>
    </header>
  )
}
```

**Week column header (week-column-header.tsx):**
Custom header for week columns with:
- Editable week name (inline edit)
- Dropdown menu: Duplicate, Delete

**Session row (session-row.tsx):**
Full-width row for day headers:
```typescript
export function SessionRow({ session }: { session: ProgramSession }) {
  return (
    <div className="day-header col-span-full px-4 py-2">
      <span className="text-[11px] font-black text-primary uppercase tracking-[0.15em]">
        {session.name}
      </span>
    </div>
  )
}
```

**Exercise row (exercise-row.tsx):**
Wrapper for exercise rows with:
- Superset prefix column (A1, B1, B2)
- Superset visual connector line
- Split row styling (dimmed name for sub-rows)
- Set type label badge

Reference UI/UX specs HTML for exact classes and structure.
  </action>
  <verify>pnpm typecheck in apps/coach-web</verify>
  <done>Grid sub-components created</done>
</task>

<task type="auto">
  <name>Task 3: Create grid-specific styles</name>
  <files>apps/coach-web/src/styles/program-grid.css</files>
  <action>
Create CSS file with grid-specific styles from UI/UX mockup:

```css
/* Program Grid Styles */

/* Spreadsheet cell base */
.spreadsheet-cell {
  @apply border-r border-b border-border relative transition-colors duration-75;
}

/* Input styling */
.spreadsheet-input {
  @apply w-full h-full bg-transparent border-none focus:ring-1 focus:ring-inset focus:ring-primary focus:bg-muted/50 text-sm py-2 px-3 placeholder:text-muted-foreground outline-none;
}

/* Sticky exercise column */
.sticky-col {
  @apply sticky left-0 z-10 bg-background shadow-[2px_0_5px_-2px_rgba(0,0,0,0.3)];
}

/* Day/session header */
.day-header {
  @apply bg-muted/60 border-y border-border;
}

/* Superset visual connector lines */
.superset-line {
  @apply absolute left-[15px] top-1/2 bottom-[-50%] w-[1.5px] bg-primary/40 z-20;
}

.superset-line-end {
  @apply absolute left-[15px] top-[-50%] bottom-1/2 w-[1.5px] bg-primary/40 z-20;
}

.superset-line-mid {
  @apply absolute left-[15px] top-[-50%] bottom-[-50%] w-[1.5px] bg-primary/40 z-20;
}

/* Split row hint icon */
.split-hint {
  @apply absolute right-1 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer text-muted-foreground hover:text-primary z-30;
}

/* Dimmed text for sub-rows */
.sub-row-text {
  @apply text-muted-foreground/50;
}

/* Set type label badge */
.set-type-badge {
  @apply text-[9px] font-bold text-muted-foreground bg-muted px-1.5 py-0.5 rounded uppercase;
}

/* Superset prefix styling */
.superset-prefix {
  @apply text-[10px] font-bold text-primary;
}
```

Import this CSS in the program editor page or global styles.
  </action>
  <verify>pnpm build in apps/coach-web - styles compiled correctly</verify>
  <done>Grid-specific styles created</done>
</task>

</tasks>

<verification>
1. Run `pnpm typecheck` - all components type-check
2. Run `pnpm dev:coach` - navigate to /programs/{id}
3. Verify grid renders with proper styling
4. Verify superset visual connectors appear correctly
5. Verify session headers span full width
</verification>

<success_criteria>
- Program editor page loads and shows grid
- Week headers are editable with actions
- Session rows span full width with day name
- Superset exercises show blue connector line
- Split rows show dimmed exercise name with set type badge
</success_criteria>

<output>
After completion, create `.planning/phases/03-program-builder/03-12-SUMMARY.md`
</output>
