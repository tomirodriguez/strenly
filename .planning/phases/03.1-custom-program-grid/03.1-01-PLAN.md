---
phase: 03.1-custom-program-grid
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/coach-web/src/features/programs/views/programs-list-view.tsx
  - apps/coach-web/src/features/programs/components/programs-table.tsx
  - apps/coach-web/src/features/programs/components/programs-table-columns.tsx
autonomous: true

must_haves:
  truths:
    - "Programs list displays as a DataTable with pagination"
    - "Table shows columns: name, status, athlete, weeks, updated date"
    - "Row actions (edit, duplicate, archive) work via dropdown menu"
    - "Search and filters work with table display"
  artifacts:
    - path: "apps/coach-web/src/features/programs/views/programs-list-view.tsx"
      provides: "Programs list view with DataTable"
      min_lines: 60
    - path: "apps/coach-web/src/features/programs/components/programs-table.tsx"
      provides: "Programs table component"
      min_lines: 40
    - path: "apps/coach-web/src/features/programs/components/programs-table-columns.tsx"
      provides: "Column definitions with actions"
      min_lines: 80
  key_links:
    - from: "programs-list-view.tsx"
      to: "DataTable.Root"
      via: "composition"
      pattern: "<DataTable\\.Root"
---

<objective>
Replace programs card grid with DataTable for scalable list view

Purpose: UAT revealed cards don't scale when coaches have many programs - tables provide better information density and sorting.
Output: Programs list using DataTable compound component with pagination, search, and row actions.
</objective>

<execution_context>
@/Users/tomiardz/.claude/get-shit-done/workflows/execute-plan.md
@/Users/tomiardz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@apps/coach-web/src/features/programs/views/programs-list-view.tsx
@apps/coach-web/src/features/programs/components/program-card.tsx
@apps/coach-web/src/features/athletes/components/athletes-table.tsx
@apps/coach-web/src/features/athletes/components/athletes-table-columns.tsx
@apps/coach-web/CLAUDE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create programs table columns with row actions</name>
  <files>apps/coach-web/src/features/programs/components/programs-table-columns.tsx</files>
  <action>
    Create column definitions following the athletes-table-columns.tsx pattern:

    1. Import from @tanstack/react-table, lucide-react icons, contracts
    2. Create ProgramRow type matching Program with optional athleteName
    3. Define columns:
       - **name**: Text column, sortable
       - **status**: Badge column (Borrador=yellow, Activo=green, Archivado=gray)
       - **athleteName**: Optional text, show "Sin atleta" if null
       - **weeksCount**: Number column (e.g., "4 semanas")
       - **isTemplate**: Badge if true
       - **updatedAt**: Relative date format
       - **actions**: DropdownMenu with Edit, Duplicate, Archive

    4. Actions column uses DropdownMenu with:
       - Edit -> onEdit callback
       - Duplicate -> onDuplicate callback
       - Archive -> onArchive callback (destructive variant)

    Reference athletes-table-columns.tsx for exact pattern with createProgramsColumns function.
  </action>
  <verify>File exists, exports createProgramsColumns function, TypeScript compiles</verify>
  <done>Column definitions exist with all required columns and action handlers</done>
</task>

<task type="auto">
  <name>Task 2: Create ProgramsTable component</name>
  <files>apps/coach-web/src/features/programs/components/programs-table.tsx</files>
  <action>
    Create ProgramsTable component following athletes-table.tsx pattern:

    1. Accept props:
       - data: ProgramRow[]
       - isLoading: boolean
       - pagination: { page, limit, total }
       - onPaginationChange: (page, limit) => void
       - onEdit, onDuplicate, onArchive callbacks

    2. Use DataTable compound component:
       ```tsx
       <DataTable.Root
         columns={columns}
         data={data}
         rowCount={pagination.total}
         pageCount={Math.ceil(pagination.total / pagination.limit)}
         state={{ pagination: { pageIndex: page - 1, pageSize: limit } }}
         onPaginationChange={...}
       >
         <DataTable.Content isLoading={isLoading} />
         <DataTablePagination />
       </DataTable.Root>
       ```

    3. Create columns inside component using createProgramsColumns with callbacks
    4. Handle loading state with skeleton rows
  </action>
  <verify>File exists, exports ProgramsTable, TypeScript compiles</verify>
  <done>ProgramsTable component renders DataTable with proper pagination handling</done>
</task>

<task type="auto">
  <name>Task 3: Update programs list view to use DataTable</name>
  <files>apps/coach-web/src/features/programs/views/programs-list-view.tsx</files>
  <action>
    Refactor ProgramsListView to use ProgramsTable instead of cards:

    1. Remove card grid rendering and ProgramCard import
    2. Import ProgramsTable
    3. Add pagination state: page, limit (default 20)
    4. Update usePrograms hook call to include page/limit
    5. Map programs to include athleteName from athleteMap
    6. Replace card grid with:
       ```tsx
       <ProgramsTable
         data={programsWithNames}
         isLoading={isLoading}
         pagination={{ page, limit, total: data?.totalCount ?? 0 }}
         onPaginationChange={(newPage, newLimit) => { setPage(newPage); setLimit(newLimit) }}
         onEdit={handleEditProgram}
         onDuplicate={handleDuplicateProgram}
         onArchive={handleArchiveProgram}
       />
       ```

    7. Keep header, filters, and empty state unchanged
    8. Remove program-card.tsx if no longer used (check for other imports first)
  </action>
  <verify>Navigate to programs list, verify table displays with data and pagination works</verify>
  <done>Programs list shows DataTable with all columns, pagination, and row actions working</done>
</task>

</tasks>

<verification>
1. Run `pnpm typecheck` - no type errors
2. Run `pnpm lint` - no lint errors
3. Navigate to /{orgSlug}/programs
4. Verify table displays with columns: Name, Status, Athlete, Weeks, Updated
5. Verify pagination controls work
6. Verify row actions dropdown works (Edit, Duplicate, Archive)
7. Verify search and status filters work with table
</verification>

<success_criteria>
- Programs display in DataTable format with proper columns
- Pagination works correctly
- Row actions trigger correct mutations
- Table supports sorting on sortable columns
- Empty state displays when no programs match filters
</success_criteria>

<output>
After completion, create `.planning/phases/03.1-custom-program-grid/03.1-01-SUMMARY.md`
</output>
