---
phase: 03.1-custom-program-grid
plan: 08
subsystem: ui
tags: [react, popover, search, debounce, tanstack-query]

# Dependency graph
requires:
  - phase: 03.1-02
    provides: ProgramForm component with athlete selection
  - phase: 02-09
    provides: useAthletes hook with server-side search support
provides:
  - Server-side athlete search with debounce in program creation
  - Dropdown-style athlete selector (Select UX instead of Combobox)
  - Scalable athlete selection for organizations with 1000+ athletes
affects: []

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "Server-side search with useDebounce hook (300ms)"
    - "Popover-based searchable dropdown for Select-style UX"

key-files:
  created: []
  modified:
    - "apps/coach-web/src/features/programs/views/new-program-view.tsx"
    - "apps/coach-web/src/features/programs/components/program-form.tsx"

key-decisions:
  - "Popover with search input for Select-style UX - dropdown opens on click, search inside"
  - "300ms debounce for server-side search to reduce API calls"
  - "Self-contained ProgramForm - fetches own athletes instead of receiving as props"

patterns-established:
  - "Searchable dropdown pattern: Popover + search input + server-side filtering"

# Metrics
duration: 3min
completed: 2026-01-25
---

# Phase 3.1 Plan 08: Fix Athlete Selector Server-Side Search Summary

**Server-side athlete search with 300ms debounce using Popover-based dropdown UX**

## Performance

- **Duration:** 3 min
- **Started:** 2026-01-25T17:32:58Z
- **Completed:** 2026-01-25T17:35:49Z
- **Tasks:** 2
- **Files modified:** 2

## Accomplishments

- Replaced client-side athlete filtering with server-side search via API
- Changed UX from Combobox (typing-first) to dropdown Select (click-first with search inside)
- Added 300ms debounce to reduce API calls during typing
- Made ProgramForm self-contained (fetches own athletes instead of receiving as props)
- Proper loading and empty states for search results

## Task Commits

Each task was committed atomically:

1. **Task 1: Update new-program-view to not pre-fetch all athletes** - `1faca9b` (refactor)
2. **Task 2: Refactor ProgramForm to use server-side athlete search with Select UX** - `b120579` (feat)

## Files Created/Modified

- `apps/coach-web/src/features/programs/views/new-program-view.tsx` - Removed useAthletes call and athletes props
- `apps/coach-web/src/features/programs/components/program-form.tsx` - Server-side search with Popover dropdown

## Decisions Made

- **Popover over Combobox:** Combobox shows input upfront (typing-first), Popover shows button trigger that opens dropdown (click-first). Plan specified Select-style UX which is click-first.
- **Self-contained form:** ProgramForm now manages its own athlete fetching. Simpler API, form is reusable without parent needing to manage athlete state.
- **Selected name in local state:** Store selected athlete name locally to display after selection, avoiding need to refetch athlete by ID.

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

- UAT Test 3 (athlete selector scalability) should now pass
- Athlete search performs server-side filtering, scales to 1000+ athletes
- Ready for verification testing

---
*Phase: 03.1-custom-program-grid*
*Completed: 2026-01-25*
