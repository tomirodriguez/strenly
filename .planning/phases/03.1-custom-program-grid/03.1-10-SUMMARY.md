---
phase: 03.1-custom-program-grid
plan: 10
subsystem: frontend-grid-superset
tags: [superset, program-grid, gap-closure, uat]
dependencies:
  requires: [03.1-07]
  provides: [dynamic-superset-groups, correct-superset-order]
  affects: []
tech-stack:
  added: []
  patterns: [useMemo-derived-state, prop-drilling-pattern]
key-files:
  created: []
  modified:
    - apps/coach-web/src/components/programs/exercise-row-actions.tsx
    - apps/coach-web/src/components/programs/program-grid/grid-body.tsx
    - apps/coach-web/src/components/programs/program-grid/exercise-row.tsx
    - apps/coach-web/src/components/programs/program-grid/exercise-cell.tsx
    - apps/coach-web/src/components/programs/program-grid.tsx
    - packages/core/src/ports/program-repository.port.ts
    - packages/backend/src/infrastructure/repositories/program.repository.ts
    - packages/backend/src/use-cases/programs/toggle-superset.ts
decisions: []
metrics:
  duration: 4 min
  completed: 2026-01-25
---

# Phase 03.1 Plan 10: Dynamic Superset Groups Summary

Dynamic superset groups derived from session data with proper order calculation.

## One-Liner

Superset dropdown now shows existing groups dynamically and calculates proper supersetOrder (A1, A2, A3) when adding to existing groups.

## Completed Tasks

| # | Task | Commit | Files |
|---|------|--------|-------|
| 1 | Update exercise-row-actions.tsx for dynamic superset groups | d534e27 | exercise-row-actions.tsx |
| 2 | Pass sessionRows prop through component tree | 1faca9b | grid-body.tsx, exercise-row.tsx, exercise-cell.tsx, program-grid.tsx |
| 3 | Fix toggle-superset.ts to calculate proper supersetOrder | 888f71f | program-repository.port.ts, program.repository.ts, toggle-superset.ts |

## Key Changes

### Frontend (Dynamic Superset Groups)

- **exercise-row-actions.tsx**: Replaced hardcoded `SUPERSET_GROUPS = ['A', 'B', 'C', 'D', 'E']` with useMemo-derived groups from session rows. Added `SessionRowData` interface for type-safe prop passing.

- **Menu options**:
  - If row has superset: "Quitar de superserie", "Cambiar a superserie X" (existing groups), "Crear superserie Y" (next letter)
  - If row has no superset: "Agregar a superserie X" (existing groups), "Crear superserie Y" (next letter)

- **Prop drilling**: sessionRows flows from grid-body -> exercise-row -> exercise-cell -> exercise-row-actions

### Backend (Proper Order Calculation)

- **ProgramRepositoryPort**: Added `getMaxSupersetOrder(ctx, sessionId, supersetGroup)` method to query maximum order in a superset group.

- **program.repository.ts**: Implemented `getMaxSupersetOrder` using SQL `COALESCE(MAX(superset_order), 0)` query filtered by sessionId and supersetGroup.

- **toggle-superset.ts**: Now queries max order when adding to superset and sets `supersetOrder = maxOrder + 1`. This ensures exercises combine as A1, A2, A3 instead of all being A1.

## Deviations from Plan

None - plan executed exactly as written.

## Technical Notes

- The SessionRowData interface is exported from exercise-row-actions.tsx to avoid circular imports
- The useMemo pattern efficiently derives existing groups only when sessionRows changes
- The next available letter calculation iterates from 'A' through 'Z'

## Verification

- TypeScript compiles successfully across all packages
- Lint passes for modified files (pre-existing issues in other files unrelated to this change)

## Next Phase Readiness

UAT Test 8 issue resolved:
- Dynamic superset groups based on session exercises
- Proper order calculation when adding to existing groups
- Blue superset indicator should now connect exercises correctly
