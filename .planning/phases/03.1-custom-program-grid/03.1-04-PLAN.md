---
phase: 03.1-custom-program-grid
plan: 04
type: execute
wave: 3
depends_on: ["03.1-03"]
files_modified:
  - apps/coach-web/src/components/programs/program-grid/grid-header.tsx
  - apps/coach-web/src/components/programs/program-grid/session-header-row.tsx
  - apps/coach-web/src/components/programs/program-grid/add-exercise-row.tsx
  - apps/coach-web/src/components/programs/program-grid/superset-indicator.tsx
autonomous: true

must_haves:
  truths:
    - "Grid header displays week columns with actions menu"
    - "Session headers span full width with styled text"
    - "Add exercise rows allow exercise search and selection"
    - "Superset indicators show vertical blue lines"
  artifacts:
    - path: "apps/coach-web/src/components/programs/program-grid/grid-header.tsx"
      provides: "Grid header with week columns"
      min_lines: 50
    - path: "apps/coach-web/src/components/programs/program-grid/session-header-row.tsx"
      provides: "Session divider row"
      min_lines: 20
    - path: "apps/coach-web/src/components/programs/program-grid/superset-indicator.tsx"
      provides: "Vertical superset line component"
      min_lines: 25
  key_links:
    - from: "grid-header.tsx"
      to: "week-actions-menu.tsx"
      via: "import"
      pattern: "import.*WeekActionsMenu"
---

<objective>
Create grid structural components: header, session rows, add exercise, and superset indicators

Purpose: Build the visual structure components that make up the grid layout - headers, dividers, and visual indicators.
Output: Reusable components for grid structure following the UI/UX specification.
</objective>

<execution_context>
@/Users/tomiardz/.claude/get-shit-done/workflows/execute-plan.md
@/Users/tomiardz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03.1-custom-program-grid/03.1-RESEARCH.md
@.planning/phases/03-program-builder/ui-ux-specifications/code.html
@apps/coach-web/src/components/programs/week-actions-menu.tsx
@apps/coach-web/src/components/programs/program-grid/types.ts
@apps/coach-web/CLAUDE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create GridHeader component</name>
  <files>apps/coach-web/src/components/programs/program-grid/grid-header.tsx</files>
  <action>
    Create sticky header row with exercise column header and week columns:

    ```typescript
    import type { GridColumn } from './types'
    import { WeekActionsMenu } from '../week-actions-menu'
    import { cn } from '@/lib/utils'

    interface GridHeaderProps {
      columns: GridColumn[]
      programId: string
      weeksCount: number
    }

    export function GridHeader({ columns, programId, weeksCount }: GridHeaderProps) {
      const isLastWeek = weeksCount === 1

      return (
        <thead className="sticky top-0 z-40">
          <tr className="bg-zinc-900">
            {columns.map((col, index) => (
              <th
                key={col.id}
                className={cn(
                  "border-r border-b-2 border-border bg-zinc-900 px-4 py-3",
                  index === 0 && "sticky left-0 z-30 w-[320px] bg-zinc-900",
                  index > 0 && "w-56 bg-zinc-900/50"
                )}
              >
                {col.type === 'exercise' ? (
                  <span className="text-[10px] font-bold text-muted-foreground uppercase tracking-[0.2em]">
                    Pairing / Exercise Selection
                  </span>
                ) : (
                  <div className="flex items-center justify-between">
                    <span className="text-[10px] font-bold text-muted-foreground uppercase tracking-widest">
                      {col.name}
                    </span>
                    {col.weekId && (
                      <WeekActionsMenu
                        programId={programId}
                        weekId={col.weekId}
                        weekName={col.name}
                        isLastWeek={isLastWeek}
                      />
                    )}
                  </div>
                )}
              </th>
            ))}
          </tr>
        </thead>
      )
    }
    ```

    Style notes from UI/UX spec:
    - First column: sticky left-0, z-30, 320px width
    - Week columns: w-56 (224px), bg-zinc-900/50
    - Text: 10px, uppercase, tracking-widest for weeks
    - Border: border-b-2 border-border
  </action>
  <verify>TypeScript compiles, component renders correctly</verify>
  <done>Grid header with sticky exercise column and week columns with actions menu</done>
</task>

<task type="auto">
  <name>Task 2: Create SessionHeaderRow and SupersetIndicator components</name>
  <files>
    apps/coach-web/src/components/programs/program-grid/session-header-row.tsx
    apps/coach-web/src/components/programs/program-grid/superset-indicator.tsx
  </files>
  <action>
    Create SessionHeaderRow:

    ```typescript
    interface SessionHeaderRowProps {
      sessionName: string
      colSpan: number
    }

    export function SessionHeaderRow({ sessionName, colSpan }: SessionHeaderRowProps) {
      return (
        <tr className="bg-zinc-900/60 border-y border-border">
          <td
            colSpan={colSpan}
            className="px-4 py-2 text-[11px] font-black text-primary uppercase tracking-[0.15em]"
          >
            {sessionName}
          </td>
        </tr>
      )
    }
    ```

    Create SupersetIndicator:

    ```typescript
    import type { SupersetPosition } from './types'
    import { cn } from '@/lib/utils'

    interface SupersetIndicatorProps {
      position: SupersetPosition
    }

    export function SupersetIndicator({ position }: SupersetIndicatorProps) {
      if (!position) return null

      return (
        <div
          className={cn(
            "absolute left-[15px] w-[1.5px] bg-primary/40 z-20",
            position === 'start' && "top-1/2 bottom-[-50%]",
            position === 'middle' && "top-[-50%] bottom-[-50%]",
            position === 'end' && "top-[-50%] bottom-1/2"
          )}
        />
      )
    }
    ```

    The superset indicator creates a vertical blue line:
    - start: line from middle of row to bottom (and beyond)
    - middle: line from top (before) to bottom (beyond)
    - end: line from top (before) to middle of row
  </action>
  <verify>TypeScript compiles, components render correctly</verify>
  <done>Session header and superset indicator components created</done>
</task>

<task type="auto">
  <name>Task 3: Create AddExerciseRow component</name>
  <files>apps/coach-web/src/components/programs/program-grid/add-exercise-row.tsx</files>
  <action>
    Create the "Add exercise" row that appears at the end of each session:

    ```typescript
    import { PlusIcon } from 'lucide-react'
    import { useState } from 'react'
    import type { GridColumn } from './types'
    import { Combobox, ComboboxContent, ComboboxInput, ComboboxItem, ComboboxList, ComboboxTrigger } from '@/components/ui/combobox'
    import { useExercises } from '@/features/exercises/hooks/queries/use-exercises'
    import { cn } from '@/lib/utils'

    interface AddExerciseRowProps {
      sessionId: string
      columns: GridColumn[]
      onAddExercise: (sessionId: string, exerciseId: string, exerciseName: string) => void
    }

    export function AddExerciseRow({ sessionId, columns, onAddExercise }: AddExerciseRowProps) {
      const [isOpen, setIsOpen] = useState(false)
      const [searchValue, setSearchValue] = useState('')

      const { data: exercisesData } = useExercises({
        search: searchValue || undefined,
        limit: 10,
      })

      const exercises = exercisesData?.items ?? []

      const handleSelect = (exerciseId: string) => {
        const exercise = exercises.find(e => e.id === exerciseId)
        if (exercise) {
          onAddExercise(sessionId, exercise.id, exercise.name)
          setSearchValue('')
          setIsOpen(false)
        }
      }

      return (
        <tr className="group opacity-30 hover:opacity-100 transition-opacity">
          <td
            className={cn(
              "sticky left-0 z-10 border-r border-b border-border bg-zinc-900/10 p-0"
            )}
          >
            <div className="flex items-center h-10">
              <span className="w-10 flex justify-center h-full items-center border-r border-border">
                <PlusIcon className="size-4 text-muted-foreground" />
              </span>
              <div className="flex-1 px-2">
                <Combobox open={isOpen} onOpenChange={setIsOpen} onValueChange={handleSelect}>
                  <ComboboxTrigger className="w-full">
                    <ComboboxInput
                      placeholder="Agregar ejercicio..."
                      value={searchValue}
                      onChange={(e) => setSearchValue(e.target.value)}
                      className="h-8 border-none bg-transparent text-sm italic placeholder:text-muted-foreground/50"
                    />
                  </ComboboxTrigger>
                  <ComboboxContent>
                    <ComboboxList>
                      {exercises.map((exercise) => (
                        <ComboboxItem key={exercise.id} value={exercise.id}>
                          {exercise.name}
                        </ComboboxItem>
                      ))}
                    </ComboboxList>
                  </ComboboxContent>
                </Combobox>
              </div>
            </div>
          </td>
          {columns.slice(1).map((col) => (
            <td key={col.id} className="border-r border-b border-border p-0" />
          ))}
        </tr>
      )
    }
    ```

    Features:
    - Plus icon in prefix column
    - Combobox with exercise search
    - Faded appearance until hover
    - Empty cells for week columns
  </action>
  <verify>TypeScript compiles, combobox search works</verify>
  <done>Add exercise row with searchable combobox for exercise selection</done>
</task>

</tasks>

<verification>
1. Run `pnpm typecheck` - no type errors
2. Run `pnpm lint` - no lint errors
3. All components exist in program-grid directory
4. Components match UI/UX specification styling
5. WeekActionsMenu is properly integrated in GridHeader
</verification>

<success_criteria>
- GridHeader shows sticky exercise column and week columns with actions
- SessionHeaderRow displays training day dividers with correct styling
- SupersetIndicator shows vertical lines for superset groups
- AddExerciseRow provides searchable exercise addition
- All components follow dark theme color scheme
</success_criteria>

<output>
After completion, create `.planning/phases/03.1-custom-program-grid/03.1-04-SUMMARY.md`
</output>
