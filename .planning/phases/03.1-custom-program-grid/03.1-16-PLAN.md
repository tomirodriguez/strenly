---
phase: 03.1-custom-program-grid
plan: 16
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/coach-web/src/features/programs/components/program-form.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Athlete selector shows only athletes when athletes exist, no erroneous empty state message"
    - "Empty state 'No se encontraron atletas' only appears when there are genuinely no matching athletes"
  artifacts:
    - path: "apps/coach-web/src/features/programs/components/program-form.tsx"
      provides: "Athlete selector with correct ComboboxEmpty placement"
      contains: "ComboboxEmpty"
  key_links:
    - from: "ComboboxEmpty"
      to: "ComboboxList"
      via: "Child of ComboboxList, not sibling"
      pattern: "ComboboxList[\\s\\S]*ComboboxEmpty"
---

<objective>
Fix athlete selector empty state visibility bug in program creation form.

Purpose: The ComboboxEmpty component is currently a sibling of ComboboxList, causing the CSS visibility rules (`group-data-empty/combobox-content:flex`) to not work correctly. The empty state shows even when athletes exist.

Output: ComboboxEmpty moved inside ComboboxList so Base UI's `data-empty` attribute properly controls visibility.
</objective>

<execution_context>
@/Users/tomiardz/.claude/get-shit-done/workflows/execute-plan.md
@/Users/tomiardz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03.1-custom-program-grid/03.1-UAT-v4.md

# Root cause from UAT diagnosis
ComboboxEmpty is rendered outside ComboboxList (line 159) as a sibling instead of a child. The CSS class `group-data-empty/combobox-content:flex` only works when ComboboxEmpty is inside ComboboxList because Base UI sets `data-empty` on the list element.

# Current structure (broken):
```tsx
<ComboboxContent>
  <ComboboxList>
    {athletes.map(...)}
  </ComboboxList>
  <ComboboxEmpty>No se encontraron atletas</ComboboxEmpty>  <!-- sibling = always visible -->
</ComboboxContent>
```

# Required structure:
```tsx
<ComboboxContent>
  <ComboboxList>
    {athletes.map(...)}
    <ComboboxEmpty>No se encontraron atletas</ComboboxEmpty>  <!-- child = controlled by data-empty -->
  </ComboboxList>
</ComboboxContent>
```
</context>

<tasks>

<task type="auto">
  <name>Task 1: Move ComboboxEmpty inside ComboboxList</name>
  <files>apps/coach-web/src/features/programs/components/program-form.tsx</files>
  <action>
Move the ComboboxEmpty component from being a sibling of ComboboxList to being the last child inside ComboboxList. This allows the Base UI CSS visibility rules to work correctly.

Current code (lines 142-160):
```tsx
<ComboboxList>
  {/* Loading state */}
  {isLoadingAthletes && athletes.length === 0 && (
    <div className="py-6 text-center text-muted-foreground text-sm">
      <Loader2Icon className="mr-2 inline h-4 w-4 animate-spin" />
      Buscando...
    </div>
  )}

  {/* Athlete options */}
  {athletes.map((athlete) => (
    <ComboboxItem key={athlete.id} value={athlete.id}>
      {athlete.name}
    </ComboboxItem>
  ))}
</ComboboxList>
<ComboboxEmpty>No se encontraron atletas</ComboboxEmpty>
```

Change to:
```tsx
<ComboboxList>
  {/* Loading state */}
  {isLoadingAthletes && athletes.length === 0 && (
    <div className="py-6 text-center text-muted-foreground text-sm">
      <Loader2Icon className="mr-2 inline h-4 w-4 animate-spin" />
      Buscando...
    </div>
  )}

  {/* Athlete options */}
  {athletes.map((athlete) => (
    <ComboboxItem key={athlete.id} value={athlete.id}>
      {athlete.name}
    </ComboboxItem>
  ))}

  {/* Empty state - must be inside ComboboxList for CSS visibility to work */}
  <ComboboxEmpty>No se encontraron atletas</ComboboxEmpty>
</ComboboxList>
```
  </action>
  <verify>
1. Run `pnpm typecheck` - should pass
2. Run `pnpm lint` - should pass
3. Manual test: Open program creation form, click athlete selector
   - With athletes: dropdown shows athlete names, NO "No se encontraron atletas" message
   - With search filter that matches no athletes: empty state message appears
  </verify>
  <done>
ComboboxEmpty is a child of ComboboxList. Empty state only shows when the list is genuinely empty.
  </done>
</task>

</tasks>

<verification>
- Open program creation form with athletes in database
- Click athlete selector dropdown
- Verify: Athletes are displayed, no "No se encontraron atletas" at bottom
- Type a search that matches nothing (e.g., "zzzzz")
- Verify: "No se encontraron atletas" appears
</verification>

<success_criteria>
- [ ] ComboboxEmpty is inside ComboboxList
- [ ] Empty state hidden when athletes exist
- [ ] Empty state shown when no matches
- [ ] TypeScript compiles without errors
- [ ] Biome lint passes
</success_criteria>

<output>
After completion, create `.planning/phases/03.1-custom-program-grid/03.1-16-SUMMARY.md`
</output>
