---
phase: 03.1-custom-program-grid
plan: 02
subsystem: programs
tags: [form, combobox, weeks, ux]
dependency-graph:
  requires:
    - 03-10 (program CRUD frontend)
  provides:
    - Program form with configurable initial weeks count
    - Searchable athlete combobox with clear option
  affects:
    - 03.1-03 (grid will display configured weeks)
tech-stack:
  added: []
  patterns:
    - Combobox for searchable selection with clear
    - Local search filtering with useMemo
key-files:
  created: []
  modified:
    - packages/contracts/src/programs/program.ts
    - packages/backend/src/use-cases/programs/create-program.ts
    - apps/coach-web/src/features/programs/components/program-form.tsx
    - apps/coach-web/src/features/programs/views/new-program-view.tsx
decisions:
  - id: weeksCount-optional-default-backend
    context: Need weeksCount field that defaults to 4
    decision: Make schema field optional, apply default in use case
    rationale: Avoids type conflicts between Zod's z.infer (output has required field) and React Hook Form input types
metrics:
  duration: 6 min
  completed: 2026-01-25
---

# Phase 3.1 Plan 02: Create Program Form Improvements Summary

Enhanced program form with weeks selector and searchable athlete combobox based on UAT feedback.

## One-liner

Program form now has weeksCount input (1-12, default 4) and athlete combobox with search and clear functionality.

## Changes Made

### 1. Contract Update (Task 1)
Added `weeksCount` field to `createProgramInputSchema`:
- Type: optional number (1-12)
- Default applied by backend: 4
- Spanish validation messages for integer, min, and max constraints

### 2. Backend Use Case Update (Task 2)
Modified `makeCreateProgram` to:
- Accept weeksCount parameter (defaults to 4)
- Create sequential weeks named "Semana 1", "Semana 2", etc.
- Use recursive ResultAsync pattern for sequential week creation

### 3. Frontend Form Update (Task 3)
Enhanced `ProgramForm` component:
- Added weeksCount number input with HTML5 constraints (min=1, max=12)
- Replaced athlete Select with searchable Combobox
- Added local search filtering via useMemo
- Added "Sin atleta asignado" option to clear selection
- Added showClear prop to display clear button when athlete selected
- Hidden weeksCount field when creating from template (inherits template structure)

## Commits

| Hash | Description |
|------|-------------|
| f3023b4 | Add weeksCount to createProgramInputSchema |
| 926a107 | Create multiple weeks based on weeksCount input |
| f6c477b | Add weeks input and athlete combobox to program form |

## Deviations from Plan

### Design Adjustment
**Schema default handling:** Changed from `z.default(4)` to `z.optional()` with backend default.
- **Reason:** Zod's `default()` transforms the output type to have required field, causing type conflicts with React Hook Form which expects input type (optional).
- **Impact:** None - behavior identical, just different implementation location for default.

## Technical Notes

### Combobox Pattern
The Base UI Combobox requires careful state management:
1. `value` prop controls selection (mapped to form field value)
2. `ComboboxInput value` shows either selected athlete name or search text
3. `onChange` on input clears selection to enable new search
4. `onValueChange` on root updates form field and clears search

### Local Search
Chose client-side filtering with useMemo over server-side search:
- Athletes already fetched (limit 100)
- Instant filtering without network latency
- Simpler implementation

## Next Phase Readiness

Ready to proceed with 03.1-03 (grid foundation). The weeksCount setting will automatically create the appropriate number of week columns when programs are created.
