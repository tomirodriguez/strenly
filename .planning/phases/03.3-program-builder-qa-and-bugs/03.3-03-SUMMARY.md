---
phase: 03.3-program-builder-qa-and-bugs
plan: 03
subsystem: ui
tags: [react, superset, dropdown-menu, program-grid]

# Dependency graph
requires:
  - phase: 03.1-custom-program-grid
    provides: Custom grid with ExerciseCell, ExerciseRowActions components
  - phase: 03.2-prescription-data-structure
    provides: groupId field for superset tracking
provides:
  - sessionRows data flow from grid-body to ExerciseRowActions
  - Superset menu showing existing groups with join/create options
affects: [program-builder, superset-functionality]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - Pass groupId data through sessionRows for dynamic group calculation
    - useMemo for deriving existingGroups and nextAvailableLetter

key-files:
  modified:
    - apps/coach-web/src/components/programs/program-grid/exercise-cell.tsx
    - apps/coach-web/src/components/programs/exercise-row-actions.tsx

key-decisions:
  - "existingGroups excludes current row to avoid showing join-to-self option"
  - "nextAvailableLetter includes all groups to avoid letter conflicts"

patterns-established:
  - "Pass session context (sessionRows) through component chain for dynamic UI"

# Metrics
duration: 4min
completed: 2026-01-26
---

# Phase 03.3 Plan 03: Fix Superset Menu Summary

**Superset menu restored with existing group display via sessionRows prop chain from grid-body to ExerciseRowActions**

## Performance

- **Duration:** 4 min
- **Started:** 2026-01-26T13:18:53Z
- **Completed:** 2026-01-26T13:22:33Z
- **Tasks:** 3
- **Files modified:** 2

## Accomplishments

- Restored superset menu functionality that was removed in commit f9c8f47
- ExerciseCell now passes sessionRows and supersetGroup to ExerciseRowActions
- Superset menu shows "Agregar a superserie [X]" for existing groups
- Superset menu shows "Crear superserie [next letter]" for new group creation
- Menu correctly excludes current row's group from join options

## Task Commits

Each task was committed atomically:

1. **Task 1: Pass sessionRows to ExerciseRowActions** - `3c03d04` (feat)
2. **Task 2: Verify data flow** - No commit needed (verification only)
3. **Task 3: Verify superset menu displays** - No commit needed (verification only)

Note: The superset menu logic was already restored in earlier commits (aa5910a) during the same phase. This plan focused on completing the data flow chain.

## Files Created/Modified

- `apps/coach-web/src/components/programs/program-grid/exercise-cell.tsx` - Added sessionRows destructuring and passing supersetGroup + sessionRows to ExerciseRowActions
- `apps/coach-web/src/components/programs/exercise-row-actions.tsx` - Already contained restored superset menu logic with existingGroups calculation and menu rendering

## Decisions Made

- **existingGroups excludes current row** (line 87): When calculating available groups to join, the current row's group is excluded to prevent showing "join your own group"
- **nextAvailableLetter uses all groups** (lines 95-104): When calculating the next letter for new group creation, all groups in the session are considered (including current row) to avoid letter conflicts

## Deviations from Plan

None - plan executed as written. The superset menu code was already restored in earlier phase commits, this plan completed the data flow connection.

## Issues Encountered

- **Pre-existing state**: The superset menu logic had been removed in commit f9c8f47 but was already restored in commit aa5910a before this plan executed. This plan focused on the remaining piece: passing sessionRows from ExerciseCell to ExerciseRowActions.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

- Superset menu is now fully functional
- Users can create supersets, join existing supersets, and remove from supersets
- Ready for manual testing of superset functionality

---
*Phase: 03.3-program-builder-qa-and-bugs*
*Completed: 2026-01-26*
