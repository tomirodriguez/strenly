---
status: diagnosed
phase: 03.3-program-builder-qa-and-bugs
source: 03.3-01-SUMMARY.md, 03.3-02-SUMMARY.md, 03.3-03-SUMMARY.md, 03.3-04-SUMMARY.md
started: 2026-01-26T14:30:00Z
updated: 2026-01-26T18:45:00Z
---

## Current Test

[testing complete]

## Tests

### 1. Edit Mode Triggers - Digit Keys
expected: Press digit (0-9) on selected cell enters edit mode with digit as first char, cursor at end
result: pass

### 2. Edit Mode Triggers - Enter/F2
expected: Press Enter or F2 on selected cell enters edit mode with existing content, cursor at end (not all text selected)
result: pass

### 3. Edit Mode Triggers - Other Keys Ignored
expected: Press letter keys (a-z) on selected cell does NOT enter edit mode - cell stays selected but not editable
result: pass

### 4. Arrow Keys in Edit Mode - Cursor Movement
expected: While editing a cell with text (cursor NOT at boundary), left/right arrow keys move cursor within the input text
result: pass

### 5. Arrow Keys at Boundaries - Focus Sync
expected: When navigating from boundary (e.g., cursor at end, press right), edit mode exits, UI shows next cell as focused, and pressing Enter enters edit mode on that NEW cell (not the old one)
result: issue
reported: "Focus state doesn't sync with visual. After boundary navigation, UI shows new cell focused but Enter triggers edit mode on the OLD cell. Internal focus reference not updated."
severity: major

### 6. Add Exercise - Local State
expected: Click "+ Agregar ejercicio" row, select an exercise from combobox. The exercise appears immediately in the grid without page refresh. The save button shows unsaved changes.
result: pass
note: Minor feedback - combobox has no debounce

### 7. Superset Menu - Create New Group
expected: Open row actions menu (three dots) on an exercise row. Submenu "Superserie" shows option to create new superset with next available letter. Uses client-side state (no backend call until save).
result: issue
reported: "Completely broken - ALL exercises now show A1. Group letter should be based on session's exerciseGroups array (A=group 0, B=group 1). Number should be position within group's exercises array (1=first, 2=second). Adding exercise to group B should make it B3 if group already has 2 exercises."
severity: blocker

### 8. Superset Menu - Join Existing Group
expected: When other superset groups exist in the same session, the Superserie submenu shows options like "Agregar a superserie [A]" to join existing groups
result: skipped
reason: Test 7 blocker - group labeling broken, can't create valid groups to join

### 9. Create Program Form - Sessions Count
expected: When creating a new program, the form shows a "Sesiones por semana" field (1-7) alongside weeks field in a compact layout. Default value is 3.
result: pass

### 10. Create Program - Sessions Created
expected: Create a program with sessionsCount=4. The grid shows 4 sessions (Dia 1, Dia 2, Dia 3, Dia 4) for each week.
result: pass

### 11. Client-Side Only Operations (CORE REQUIREMENT)
expected: ALL builder operations (add week, add session, add exercise, superset changes, prescription edits) happen in client-side state ONLY. NO API calls until user clicks "Guardar". Network tab shows zero requests during editing.
result: issue
reported: "Core requirement not addressed. Add session/week trigger API calls. Superset operations trigger API. ALL must be client-side until explicit save. Delete partial-save endpoints."
severity: blocker

### 12. Exercise Combobox Debounce
expected: When typing in exercise search combobox, API calls are debounced (300-500ms delay). Rapid typing doesn't flood the server with requests.
result: issue
reported: "No debounce - every keystroke triggers immediate API call"
severity: minor

## Summary

total: 12
passed: 6
issues: 4
pending: 0
skipped: 2

## Gaps

- truth: "After boundary navigation, internal focus state matches visual indicator so Enter triggers edit on the NEW focused cell"
  status: failed
  reason: "User reported: Focus state doesn't sync with visual. After boundary navigation (cursor at end, press right), UI shows new cell focused but Enter triggers edit mode on the OLD cell."
  severity: major
  test: 5
  root_cause: "stopEditing in use-cell-editing.ts unconditionally restores DOM focus to OLD cell via lastEditedCellRef, overwriting navigation that occurred during edit-commit-navigate sequence"
  artifacts:
    - path: "apps/coach-web/src/components/programs/program-grid/use-cell-editing.ts"
      issue: "Lines 49-55: stopEditing calls focusCell(lastEditedCellRef) which overwrites navigation to new cell"
  missing:
    - "Remove focus restoration logic from stopEditing - useGridNavigation already syncs DOM focus to activeCell state"
  debug_session: ".planning/debug/focus-state-boundary-navigation.md"

- truth: "Exercise rows show correct group letter (A/B/C based on group index) and position number (1/2/3 based on position in group)"
  status: failed
  reason: "User reported: ALL exercises show A1. Broken labeling. Expected: Letter = group index in session, Number = position within group's exercises array."
  severity: blocker
  test: 7
  root_cause: "updateSupersetGroup in grid-store.ts only updates individual row's supersetGroup/groupLetter but NEVER recalculates groupIndex. New rows via addExercise created with undefined groupLetter/groupIndex. exercise-row-prefix.tsx defaults to 'A' and 1 when undefined."
  artifacts:
    - path: "apps/coach-web/src/stores/grid-store.ts"
      issue: "updateSupersetGroup (lines 244-263) doesn't recalculate groupIndex for session rows"
    - path: "apps/coach-web/src/stores/grid-store.ts"
      issue: "addExercise (lines 209-210) creates rows with undefined groupLetter/groupIndex"
    - path: "apps/coach-web/src/components/programs/program-grid/transform-program.ts"
      issue: "Correct calculation logic exists (lines 135-232) but not reused after store changes"
  missing:
    - "Extract group calculation from transform-program.ts into reusable function"
    - "Call recalculation after updateSupersetGroup and addExercise to update all rows in session"
  debug_session: ".planning/debug/exercise-row-a1-labels.md"

- truth: "ALL program builder operations are client-side only - NO API calls until user explicitly saves"
  status: failed
  reason: "User reported: Core requirement not addressed. Add session triggers API call. Add week triggers API call. Superset operations trigger API calls. ALL operations must be client-side in Zustand store until user clicks Save button. Every partial-save endpoint used in builder must be deleted."
  severity: blocker
  test: N/A (core architectural requirement)
  root_cause: "Grid toolbar actions (add week, add session) and superset menu still use server mutations instead of Zustand store actions"
  artifacts:
    - path: "apps/coach-web/src/components/programs/program-grid/grid-toolbar.tsx"
      issue: "Add week/session buttons call useAddWeek/useAddSession mutations directly"
    - path: "apps/coach-web/src/components/programs/exercise-row-actions.tsx"
      issue: "Superset operations may still trigger backend calls"
    - path: "apps/coach-web/src/stores/grid-store.ts"
      issue: "Missing addWeek and addSession actions for client-side state"
    - path: "packages/backend/src/procedures/programs/"
      issue: "Partial-save endpoints (addWeek, addSession, updateExerciseRow, etc.) should be deprecated/removed"
  missing:
    - "Add addWeek action to grid-store.ts"
    - "Add addSession action to grid-store.ts"
    - "Wire grid toolbar to use store actions instead of mutations"
    - "Ensure ALL superset operations use store only"
    - "Extend saveDraft to handle full program structure (weeks, sessions, exercises, prescriptions)"
    - "Delete or deprecate partial-save endpoints no longer needed"
  debug_session: ""

- truth: "Exercise combobox debounces search input to prevent excessive API calls"
  status: failed
  reason: "User reported: Combobox has no debounce while searching - every keystroke triggers API call"
  severity: minor
  test: 6
  root_cause: "Exercise search combobox lacks debounce on input change"
  artifacts:
    - path: "apps/coach-web/src/components/programs/program-grid/exercise-cell.tsx"
      issue: "Search input onChange triggers immediate API call without debounce"
  missing:
    - "Add useDebouncedValue or similar to debounce search input (300-500ms)"
  debug_session: ""
