---
status: diagnosed
phase: 03.3-program-builder-qa-and-bugs
source: 03.3-01-SUMMARY.md, 03.3-02-SUMMARY.md, 03.3-03-SUMMARY.md, 03.3-04-SUMMARY.md
started: 2026-01-26T14:30:00Z
updated: 2026-01-26T14:45:00Z
---

## Current Test

[testing complete]

## Tests

### 1. Edit Mode Triggers - Digit Keys
expected: Press digit (0-9) on selected cell enters edit mode with digit as first char, cursor at end
result: pass

### 2. Edit Mode Triggers - Enter/F2
expected: Press Enter or F2 on selected cell enters edit mode with existing content, cursor at end (not all text selected)
result: pass

### 3. Edit Mode Triggers - Other Keys Ignored
expected: Press letter keys (a-z) on selected cell does NOT enter edit mode - cell stays selected but not editable
result: pass

### 4. Arrow Keys in Edit Mode - Cursor Movement
expected: While editing a cell with text, left/right arrow keys move cursor within the input text (not to adjacent cells)
result: issue
reported: "On edit mode, if I press the arrows (left/right/up/down) it changes the cell. It doesnt navigate in the input"
severity: major

### 5. Arrow Keys at Boundaries
expected: When cursor is at start of input, left arrow navigates to previous cell. When at end, right arrow navigates to next cell.
result: skipped
reason: Depends on Test 4 (cursor movement within input) which failed

### 6. Add Exercise - Local State
expected: Click "+ Agregar ejercicio" row, select an exercise from combobox. The exercise appears immediately in the grid without page refresh. The save button shows unsaved changes.
result: pass
note: Minor feedback - combobox has no debounce

### 7. Superset Menu - Create New Group
expected: Open row actions menu (three dots) on an exercise row. Submenu "Superserie" shows option to create new superset with next available letter (e.g., "Crear superserie [B]")
result: issue
reported: "If i click on C1 I only get 'Crear superserie A'. Superset should link to existing group not create new structure. Also keeps triggering backend API, should be client-side only."
severity: major

### 8. Superset Menu - Join Existing Group
expected: When other superset groups exist in the same session, the Superserie submenu shows options like "Agregar a superserie [A]" to join existing groups
result: skipped
reason: Can't create supersets - update endpoint fails with FK constraint error (group_id not in exercise_groups table)

### 9. Create Program Form - Sessions Count
expected: When creating a new program, the form shows a "Sesiones por semana" field (1-7) alongside weeks field in a compact layout. Default value is 3.
result: pass

### 10. Create Program - Sessions Created
expected: Create a program with sessionsCount=4. The grid shows 4 sessions (Dia 1, Dia 2, Dia 3, Dia 4) for each week.
result: pass

## Summary

total: 10
passed: 6
issues: 2
pending: 0
skipped: 2

## Gaps

- truth: "Arrow keys in edit mode move cursor within input text, not navigate to adjacent cells"
  status: failed
  reason: "User reported: On edit mode, if I press the arrows (left/right/up/down) it changes the cell. It doesnt navigate in the input"
  severity: major
  test: 4
  root_cause: "prescription-cell.tsx handleKeyDown does not call e.stopPropagation() for non-boundary arrow keys, allowing events to bubble to grid navigation handler which unconditionally navigates"
  artifacts:
    - path: "apps/coach-web/src/components/programs/program-grid/prescription-cell.tsx"
      issue: "Lines 93-110: Missing e.stopPropagation() for non-boundary arrow key presses"
    - path: "apps/coach-web/src/components/programs/program-grid/use-grid-navigation.ts"
      issue: "Lines 97-113: Unconditionally handles all arrow keys without checking edit mode"
  missing:
    - "Add e.stopPropagation() in prescription-cell.tsx for ArrowLeft/ArrowRight when cursor is NOT at boundary"
  debug_session: ".planning/debug/arrow-keys-edit-mode.md"

- truth: "Superset menu shows option to join existing groups and uses client-side state"
  status: failed
  reason: "User reported: If i click on C1 I only get 'Crear superserie A'. Superset should link to existing group not create new structure. Also keeps triggering backend API, should be client-side only. Additional: FK constraint error - group_id 'A' not present in exercise_groups table when trying to update."
  severity: major
  test: 7
  root_cause: "exercise-row-actions.tsx calls backend mutation directly instead of Zustand store, passes letter 'A' as groupId but backend expects UUID FK to exercise_groups table"
  artifacts:
    - path: "apps/coach-web/src/components/programs/exercise-row-actions.tsx"
      issue: "Lines 134-137: Calls useUpdateExerciseRow mutation directly, lines 101-104: generates letter instead of UUID"
    - path: "apps/coach-web/src/stores/grid-store.ts"
      issue: "Missing updateSupersetGroup action for client-side state management"
    - path: "packages/database/src/schema/program-exercises.ts"
      issue: "Line 25: FK constraint requires valid exercise_groups.id (UUID), not letter"
  missing:
    - "Add updateSupersetGroup action to grid-store.ts"
    - "Modify exercise-row-actions.tsx to use store action instead of backend mutation"
    - "Extend saveDraft to create exercise_groups records and map letters to UUIDs"
  debug_session: ".planning/debug/superset-menu-issues.md"
