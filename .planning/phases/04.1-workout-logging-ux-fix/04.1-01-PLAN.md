---
phase: 04.1-workout-logging-ux-fix
plan: 01
type: execute
wave: 1
depends_on: ["04-10"]
files_modified:
  - apps/coach-web/src/routes/_authenticated/$orgSlug/athletes.tsx
  - apps/coach-web/src/routes/_authenticated/$orgSlug/athletes/index.tsx
  - apps/coach-web/src/routes/_authenticated/$orgSlug/athletes/$athleteId/index.tsx
  - apps/coach-web/src/features/athletes/views/athlete-detail-view.tsx
  - apps/coach-web/src/components/layout/app-sidebar.tsx
autonomous: true

must_haves:
  truths:
    - "Athletes route has Outlet to render child routes"
    - "Athlete detail page shows athlete info and their program"
    - "Session logging route renders correctly"
    - "Registro removed from sidebar navigation"
  artifacts:
    - path: "apps/coach-web/src/routes/_authenticated/$orgSlug/athletes/index.tsx"
      provides: "Athletes list route"
      min_lines: 10
    - path: "apps/coach-web/src/routes/_authenticated/$orgSlug/athletes/$athleteId/index.tsx"
      provides: "Athlete detail route"
      min_lines: 15
    - path: "apps/coach-web/src/features/athletes/views/athlete-detail-view.tsx"
      provides: "Athlete detail view component"
      exports: ["AthleteDetailView"]
---

<objective>
Fix the workout logging UX by restructuring the athletes routes and creating the missing athlete detail page.

**Root Cause:** The `athletes.tsx` route renders `AthletesListView` directly without an `<Outlet />`. This means child routes (like `/athletes/$athleteId/log/$sessionId`) never render - the parent absorbs everything.

**Fix:**
1. Convert `athletes.tsx` to a layout with `<Outlet />`
2. Move list view to `athletes/index.tsx`
3. Create athlete detail page at `athletes/$athleteId/index.tsx`
4. Remove "Registro" from sidebar (concept doesn't make sense)

Output: Working navigation flow: Athletes list → Athlete detail → Log session
</objective>

<execution_context>
@/Users/tomiardz/.claude/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/04.1-workout-logging-ux-fix/04.1-CONTEXT.md

# Current files to modify
@apps/coach-web/src/routes/_authenticated/$orgSlug/athletes.tsx
@apps/coach-web/src/features/athletes/views/athletes-list-view.tsx

# Reference patterns
@apps/coach-web/src/routes/_authenticated/$orgSlug/programs.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix Athletes Route Structure</name>
  <files>
    apps/coach-web/src/routes/_authenticated/$orgSlug/athletes.tsx
    apps/coach-web/src/routes/_authenticated/$orgSlug/athletes/index.tsx
  </files>
  <action>
**athletes.tsx - Convert to layout route:**
```typescript
import { Outlet, createFileRoute } from '@tanstack/react-router'

export const Route = createFileRoute('/_authenticated/$orgSlug/athletes')({
  component: AthletesLayout,
})

function AthletesLayout() {
  return <Outlet />
}
```

**athletes/index.tsx - New file for list:**
```typescript
import { createFileRoute } from '@tanstack/react-router'
import { AthletesListView } from '@/features/athletes/views/athletes-list-view'

export const Route = createFileRoute('/_authenticated/$orgSlug/athletes/')({
  component: AthletesListView,
})
```

This fixes the routing so child routes render properly.
  </action>
  <verify>
    `pnpm typecheck` passes
    Navigate to /athletes shows list
    Navigate to /athletes/$athleteId/log/$sessionId renders (not blocked)
  </verify>
  <done>
    Athletes route structure fixed with proper Outlet
    Child routes now render correctly
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Athlete Detail Page</name>
  <files>
    apps/coach-web/src/routes/_authenticated/$orgSlug/athletes/$athleteId/index.tsx
    apps/coach-web/src/features/athletes/views/athlete-detail-view.tsx
  </files>
  <action>
**Route file (athletes/$athleteId/index.tsx):**
```typescript
import { createFileRoute } from '@tanstack/react-router'
import { AthleteDetailView } from '@/features/athletes/views/athlete-detail-view'

export const Route = createFileRoute('/_authenticated/$orgSlug/athletes/$athleteId/')({
  component: AthleteDetailPage,
})

function AthleteDetailPage() {
  const { athleteId } = Route.useParams()
  return <AthleteDetailView athleteId={athleteId} />
}
```

**View component (athlete-detail-view.tsx):**

Create a view that shows:
1. Athlete header (name, email, status badge)
2. Their assigned program (if any) with expandable weeks/sessions
3. Each session has "Registrar" button linking to session logging
4. Quick link to "Ver Historial" for log history
5. Back button to athletes list

Use existing hooks:
- Check if there's a `useAthlete` hook or create one
- Use the athlete data from the API

For the program section:
- If athlete has a programId, fetch the program aggregate
- Display weeks as collapsible sections
- Each session row shows session name + "Registrar" button

The "Registrar" button links to:
```
/$orgSlug/athletes/$athleteId/log/$sessionId?programId=X&weekId=Y
```
  </action>
  <verify>
    Route renders at /athletes/$athleteId
    Shows athlete info
    Shows program structure if athlete has one
    Registrar buttons link correctly
  </verify>
  <done>
    Athlete detail page shows athlete info and program
    Can navigate to log any session
  </done>
</task>

<task type="auto">
  <name>Task 3: Update Athletes List Row Actions</name>
  <files>apps/coach-web/src/features/athletes/components/athletes-table.tsx</files>
  <action>
Update the athletes table row actions:
1. First action should be "Ver Atleta" linking to athlete detail page
2. Keep "Ver Historial" as secondary action
3. Keep other existing actions (edit, archive, etc.)

The row itself could also be clickable to navigate to detail.
  </action>
  <verify>
    Row actions include "Ver Atleta"
    Clicking navigates to athlete detail page
  </verify>
  <done>
    Athletes table has proper navigation to detail page
  </done>
</task>

<task type="auto">
  <name>Task 4: Remove Registro from Sidebar</name>
  <files>apps/coach-web/src/components/layout/app-sidebar.tsx</files>
  <action>
Remove the "Registro" navigation item from the sidebar.

The "pending workouts" dashboard concept doesn't work without scheduling.
Coaches access workout logging through: Atletas → Athlete Detail → Log Session

Find and remove the nav item that links to `/logging`.
  </action>
  <verify>
    Sidebar no longer shows "Registro"
    Navigation still works
  </verify>
  <done>
    Registro removed from sidebar
    Cleaner navigation without confusing entry point
  </done>
</task>

<task type="auto">
  <name>Task 5: Optional - Delete Unused Logging Dashboard</name>
  <files>
    apps/coach-web/src/routes/_authenticated/$orgSlug/logging/index.tsx
    apps/coach-web/src/features/workout-logs/views/logging-dashboard-view.tsx
    apps/coach-web/src/features/workout-logs/components/pending-workouts-table.tsx
  </files>
  <action>
Since the "pending workouts" concept was removed, clean up unused files:

1. Delete `apps/coach-web/src/routes/_authenticated/$orgSlug/logging/` folder
2. Delete `logging-dashboard-view.tsx`
3. Delete `pending-workouts-table.tsx`

Also remove the `listPendingWorkouts` hook if it's no longer used:
- `apps/coach-web/src/features/workout-logs/hooks/queries/use-pending-workouts.ts`

Keep the backend procedure (listPending) - it might be useful later when scheduling is added.
  </action>
  <verify>
    Files deleted
    No import errors
    `pnpm typecheck` passes
  </verify>
  <done>
    Unused logging dashboard code removed
    Codebase cleaned up
  </done>
</task>

</tasks>

<verification>
```bash
# TypeScript compiles
pnpm typecheck

# Start dev and verify flow
pnpm dev:coach

# Test navigation:
# 1. Go to /test/athletes (list)
# 2. Click on athlete row or "Ver Atleta" action
# 3. See athlete detail with their program
# 4. Click "Registrar" on a session
# 5. Session logging view renders correctly
# 6. Save a log
# 7. Go back to athlete detail
# 8. Click "Ver Historial"
# 9. See log history
```
</verification>

<success_criteria>
1. Athletes list renders at /athletes
2. Athlete detail renders at /athletes/$athleteId
3. Athlete detail shows athlete info and their program
4. Session logging renders at /athletes/$athleteId/log/$sessionId
5. Complete flow works: List → Detail → Log → Save → History
6. "Registro" removed from sidebar
7. No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/04.1-workout-logging-ux-fix/04.1-01-SUMMARY.md`
</output>
