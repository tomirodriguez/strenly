---
phase: 03.4-domain-restructure-training-programs
plan: 02
subsystem: domain
tags: [typescript, clean-architecture, domain-entities, aggregate]

# Dependency graph
requires:
  - phase: 03.4-01
    provides: Program aggregate with full hierarchy (Program/Week/Session/ExerciseGroup/GroupItem/Series)
  - phase: 03.4-04
    provides: Use cases migrated to aggregate pattern
  - phase: 03.4-05
    provides: Procedures and contracts migrated to aggregate pattern
provides:
  - Clean domain layer with only aggregate structure
  - Updated repository port using aggregate types
  - Updated core package exports
affects: [03.4-03, backend-repository, any code importing from @strenly/core]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "Single Program type from aggregate (no LegacyProgram alias)"
    - "Series[] replaces Prescription for cell data"

key-files:
  created: []
  modified:
    - packages/core/src/ports/program-repository.port.ts
    - packages/core/src/index.ts

key-decisions:
  - "Delete all legacy code completely (no deprecated folder) per user decision"
  - "Series[] replaces Prescription type for prescription cell data"
  - "Single Program type exported from aggregate module"

patterns-established:
  - "Program aggregate is the only domain model for training programs"
  - "All program-related types come from program/types.ts"

# Metrics
duration: 3min
completed: 2026-01-26
---

# Phase 03.4 Plan 02: Delete Legacy Domain Entities Summary

**Deleted 8 legacy domain entity files (prescription, exercise-group, program) and updated repository port to use aggregate types**

## Performance

- **Duration:** 3 min
- **Started:** 2026-01-26T21:27:44Z
- **Completed:** 2026-01-26T21:30:44Z
- **Tasks:** 3 (Task 3 required no changes)
- **Files deleted:** 8
- **Files modified:** 2

## Accomplishments
- Deleted legacy flat domain entities (prescription.ts, prescription-series.ts, exercise-group.ts, program.ts) and their tests
- Updated repository port imports to use Program aggregate types
- Updated core package exports to expose aggregate module instead of deleted files
- All 204 core package tests pass

## Task Commits

Each task was committed atomically:

1. **Task 1: Delete Legacy Domain Entity Files** - `b7c2b79` (refactor)
2. **Task 2: Update Repository Port Imports** - `5490738` (refactor)
3. **Task 3: Fix Any Remaining Import Errors** - No commit needed (already fixed in Task 2)

## Files Deleted
- `packages/core/src/domain/entities/prescription.ts` - Old Prescription entity with sets:number
- `packages/core/src/domain/entities/prescription.test.ts` - Tests for old Prescription
- `packages/core/src/domain/entities/prescription-series.ts` - Old standalone PrescriptionSeries
- `packages/core/src/domain/entities/prescription-series.test.ts` - Tests for old PrescriptionSeries
- `packages/core/src/domain/entities/exercise-group.ts` - Old standalone ExerciseGroup
- `packages/core/src/domain/entities/exercise-group.test.ts` - Tests for old ExerciseGroup
- `packages/core/src/domain/entities/program.ts` - Old flat Program entity
- `packages/core/src/domain/entities/program.test.ts` - Tests for old Program

## Files Modified
- `packages/core/src/ports/program-repository.port.ts` - Updated imports, replaced LegacyProgram/ProgramAggregate with Program, Prescription with Series[]
- `packages/core/src/index.ts` - Updated exports to use program aggregate module

## Decisions Made
- **Series[] replaces Prescription:** The old Prescription type was a wrapper around series data. Now we use Series[] directly for cell data in the repository port types.
- **Single Program type:** Removed the LegacyProgram/ProgramAggregate aliasing - now there's just Program from the aggregate.

## Deviations from Plan
None - plan executed exactly as written.

## Issues Encountered
None - deletion and port updates went smoothly.

## User Setup Required
None - no external service configuration required.

## Next Phase Readiness
- Core package clean with only aggregate structure
- Repository port types updated for aggregate pattern
- Backend package (repository implementation) may need updates to match port changes
- Plan 03 (repository refactoring) can proceed

---
*Phase: 03.4-domain-restructure-training-programs*
*Completed: 2026-01-26*
