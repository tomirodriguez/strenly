---
phase: 02.5-coach-web-foundation
plan: 07
subsystem: ui
tags: [react, tanstack-router, better-auth, organization-context, api-headers]

# Dependency graph
requires:
  - phase: 02.5-coach-web-foundation
    provides: Better-Auth setup with organization hooks
provides:
  - Organization context sync between Better-Auth and API client
  - X-Organization-Slug header on all authenticated API requests
affects: [dashboard-stats, athletes-list, create-athlete, all-org-scoped-endpoints]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "Organization sync via useEffect in authenticated layout"
    - "setCurrentOrgSlug syncs Better-Auth state to API client"

key-files:
  created: []
  modified:
    - apps/coach-web/src/routes/_authenticated.tsx

key-decisions:
  - "Sync org in _authenticated.tsx layout rather than AppShell - runs once before all child routes"
  - "useEffect syncs on activeOrg?.slug change to handle org switching"

patterns-established:
  - "Organization header sync: useActiveOrganization + setCurrentOrgSlug in layout"

# Metrics
duration: 1min
completed: 2026-01-24
---

# Phase 2.5 Plan 07: Organization Header Sync Summary

**Fixed organization header synchronization by adding useEffect in AuthenticatedLayout that calls setCurrentOrgSlug when Better-Auth's active organization changes**

## Performance

- **Duration:** 1 min
- **Started:** 2026-01-24T14:52:25Z
- **Completed:** 2026-01-24T14:53:56Z
- **Tasks:** 1
- **Files modified:** 1

## Accomplishments
- Added organization sync effect to AuthenticatedLayout component
- API calls now include X-Organization-Slug header when user has active organization
- Unblocked dashboard stats, athletes list, and create athlete functionality

## Task Commits

Each task was committed atomically:

1. **Task 1: Sync active organization with API client** - `9c1d7c3` (fix)

## Files Created/Modified
- `apps/coach-web/src/routes/_authenticated.tsx` - Added useActiveOrganization hook and useEffect to sync org slug with API client

## Decisions Made
- **Sync location:** Placed sync in `_authenticated.tsx` layout rather than `AppShell` - the layout wraps all authenticated routes and runs once before child routes render/fetch data
- **Dependency array:** Used `activeOrg?.slug` as the dependency to re-sync when organization changes (org switching scenario)

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

Pre-existing typecheck errors in `athlete-form.tsx` and `athletes-list-view.tsx` were detected but are unrelated to this change. These are existing issues in other files that need separate attention.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness
- Organization context now flows correctly to all API calls
- Tests 1 (signup), 3 (dashboard stats), 7 (athletes list), 8 (create athlete) should now be unblocked
- Remaining fixes in plans 08 and 09 can proceed

---
*Phase: 02.5-coach-web-foundation*
*Plan: 07*
*Completed: 2026-01-24*
