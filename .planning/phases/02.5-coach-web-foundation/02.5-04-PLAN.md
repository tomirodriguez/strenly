---
phase: 02.5-coach-web-foundation
plan: 04
type: execute
wave: 3
depends_on: ["02.5-01", "02.5-02"]
files_modified:
  - apps/coach-web/src/routes/_authenticated/athletes.tsx
  - apps/coach-web/src/features/athletes/views/athletes-list-view.tsx
  - apps/coach-web/src/features/athletes/components/athletes-table.tsx
  - apps/coach-web/src/features/athletes/components/athlete-form.tsx
  - apps/coach-web/src/features/athletes/components/invitation-status.tsx
  - apps/coach-web/src/features/athletes/hooks/queries/use-athletes.ts
  - apps/coach-web/src/features/athletes/hooks/mutations/use-create-athlete.ts
  - apps/coach-web/src/features/athletes/hooks/mutations/use-update-athlete.ts
  - apps/coach-web/src/features/athletes/hooks/mutations/use-archive-athlete.ts
  - apps/coach-web/src/features/athletes/hooks/mutations/use-generate-invitation.ts
autonomous: true

must_haves:
  truths:
    - "Coach can view paginated list of athletes"
    - "Coach can search athletes by name"
    - "Coach can create new athlete via drawer form"
    - "Coach can edit existing athlete via drawer form"
    - "Coach can archive athlete via row action"
    - "Coach can generate invitation link and copy to clipboard"
    - "Invitation status badge shows pending/accepted/expired/not invited"
  artifacts:
    - path: "apps/coach-web/src/features/athletes/views/athletes-list-view.tsx"
      provides: "Athletes list page"
      min_lines: 80
    - path: "apps/coach-web/src/features/athletes/components/athletes-table.tsx"
      provides: "Athletes DataTable with columns"
      min_lines: 60
    - path: "apps/coach-web/src/features/athletes/hooks/queries/use-athletes.ts"
      provides: "Athletes query hook"
      contains: "useQuery"
  key_links:
    - from: "apps/coach-web/src/features/athletes/hooks/queries/use-athletes.ts"
      to: "lib/api-client.ts"
      via: "orpc.athletes.list"
      pattern: "orpc\\.athletes\\.list"
    - from: "apps/coach-web/src/features/athletes/views/athletes-list-view.tsx"
      to: "features/athletes/hooks/queries/use-athletes.ts"
      via: "useAthletes hook"
      pattern: "useAthletes"
---

<objective>
Create the athletes management feature: list view with DataTable, create/edit forms in drawer, and invitation management.

Purpose: Coaches need to manage their athletes - create profiles, update info, and invite them to join.
Output: Complete athlete management UI with CRUD operations and invitation links.
</objective>

<execution_context>
@/Users/tomiardz/.claude/get-shit-done/workflows/execute-plan.md
@/Users/tomiardz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/02.5-coach-web-foundation/02.5-CONTEXT.md
@.planning/phases/02.5-coach-web-foundation/02.5-RESEARCH.md
@.planning/phases/02.5-coach-web-foundation/02.5-02-SUMMARY.md
@packages/contracts/src/athletes/athlete.ts
@packages/contracts/src/athletes/invitation.ts
@apps/coach-web/src/lib/api-client.ts
@apps/coach-web/src/components/ui/sheet.tsx
@apps/coach-web/src/components/ui/badge.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create athlete query and mutation hooks</name>
  <files>
    apps/coach-web/src/features/athletes/hooks/queries/use-athletes.ts
    apps/coach-web/src/features/athletes/hooks/mutations/use-create-athlete.ts
    apps/coach-web/src/features/athletes/hooks/mutations/use-update-athlete.ts
    apps/coach-web/src/features/athletes/hooks/mutations/use-archive-athlete.ts
    apps/coach-web/src/features/athletes/hooks/mutations/use-generate-invitation.ts
  </files>
  <action>
Create the query and mutation hooks for athletes:

1. Create `features/athletes/hooks/queries/use-athletes.ts`:
   - Define athleteKeys factory: all, list(filters), detail(id)
   - useAthletes hook accepting ListAthletesInput
   - Use orpc.athletes.list.queryOptions({ input })
   - Return useQuery result

2. Create `features/athletes/hooks/mutations/use-create-athlete.ts`:
   - useCreateAthlete hook
   - Use orpc.athletes.create
   - onSuccess: invalidate athleteKeys.all, show success toast
   - onError: show error toast with message
   - Return useMutation result

3. Create `features/athletes/hooks/mutations/use-update-athlete.ts`:
   - useUpdateAthlete hook
   - Use orpc.athletes.update
   - onSuccess: invalidate athleteKeys.all and athleteKeys.detail(id), show success toast
   - onError: show error toast

4. Create `features/athletes/hooks/mutations/use-archive-athlete.ts`:
   - useArchiveAthlete hook
   - Use orpc.athletes.archive
   - onSuccess: invalidate athleteKeys.all, show success toast
   - onError: show error toast

5. Create `features/athletes/hooks/mutations/use-generate-invitation.ts`:
   - useGenerateInvitation hook
   - Use orpc.athletes.generateInvitation
   - onSuccess: copy invitationUrl to clipboard, show success toast "Invitation link copied!"
   - onError: show error toast
   - Use navigator.clipboard.writeText()

Pattern from research:
```typescript
export const athleteKeys = {
  all: ['athletes'] as const,
  list: (filters: ListAthletesInput) => [...athleteKeys.all, 'list', filters] as const,
  detail: (id: string) => [...athleteKeys.all, 'detail', id] as const,
}

export function useAthletes(input: ListAthletesInput) {
  return useQuery(orpc.athletes.list.queryOptions({ input }))
}
```
  </action>
  <verify>
Run `pnpm typecheck` to verify hooks compile correctly.
  </verify>
  <done>
All athlete query and mutation hooks are created with proper cache invalidation.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create athlete table and invitation status</name>
  <files>
    apps/coach-web/src/features/athletes/components/athletes-table.tsx
    apps/coach-web/src/features/athletes/components/invitation-status.tsx
  </files>
  <action>
Create the athletes table component with columns:

1. Create `features/athletes/components/invitation-status.tsx`:
   - Badge component showing invitation state
   - States: "Not invited" (default), "Pending" (warning), "Accepted" (success), "Expired" (destructive)
   - Props: athlete (includes linkedUserId and invitation info if available)
   - Determine status from: linkedUserId set = "Accepted", has pending invitation = "Pending", expired = "Expired", else "Not invited"
   - Use shadcn Badge with variant prop

2. Create `features/athletes/components/athletes-table.tsx`:
   - Use DataTable compound component from plan 02
   - Define columns: Name, Email, Status, Invitation, Created, Actions
   - Name: athlete.name (bold)
   - Email: athlete.email or "-" if null
   - Status: Badge with "Active"/"Inactive" based on athlete.status
   - Invitation: InvitationStatus component
   - Created: format athlete.createdAt with date-fns (formatDistanceToNow)
   - Actions: DataTableRowActions with Edit, Generate Invite, Archive
   - Props: data, totalCount, pageIndex, pageSize, onPageChange, isLoading, onEdit, onArchive, onInvite

Columns definition:
```typescript
const columns: ColumnDef<Athlete>[] = [
  {
    accessorKey: 'name',
    header: 'Name',
    cell: ({ row }) => <span className="font-medium">{row.original.name}</span>,
  },
  {
    accessorKey: 'email',
    header: 'Email',
    cell: ({ row }) => row.original.email ?? '-',
  },
  // ... more columns
]
```
  </action>
  <verify>
Import AthletesTable in a test component and verify columns render correctly with mock data.
  </verify>
  <done>
Athletes table renders with all columns and row actions are clickable.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create athlete form and list view</name>
  <files>
    apps/coach-web/src/features/athletes/components/athlete-form.tsx
    apps/coach-web/src/features/athletes/views/athletes-list-view.tsx
    apps/coach-web/src/routes/_authenticated/athletes.tsx
  </files>
  <action>
Create the athlete form and list view:

1. Create `features/athletes/components/athlete-form.tsx`:
   - React Hook Form with createAthleteInputSchema from contracts
   - Fields: name (required), email, phone, birthdate (date picker), gender (select), notes (textarea)
   - Use Field, FieldLabel, FieldError for consistent styling
   - Props: onSubmit, onCancel, isSubmitting, defaultValues (for edit mode)
   - Use standardSchemaResolver for Zod validation
   - Submit and Cancel buttons at bottom

2. Create `features/athletes/views/athletes-list-view.tsx`:
   - State: search, pageIndex (0), pageSize (10), showArchived (false), drawerOpen (false), editingAthlete (null)
   - Use useAthletes hook with filters
   - DataTable with Toolbar, Search, Content, Pagination
   - "Add Athlete" button in toolbar right slot
   - Toggle for "Show archived" in toolbar
   - Sheet (drawer) for create/edit form
   - Handle form submit: create or update based on editingAthlete
   - Close drawer and reset form on success
   - Row actions trigger edit (open drawer), archive (confirm dialog), invite (generate link)

3. Create thin route:
   - `routes/_authenticated/athletes.tsx`: createFileRoute, component: AthletesListView

List view structure:
```typescript
export function AthletesListView() {
  const [search, setSearch] = useState('')
  const [pageIndex, setPageIndex] = useState(0)
  const [pageSize, setPageSize] = useState(10)
  const [showArchived, setShowArchived] = useState(false)
  const [drawerOpen, setDrawerOpen] = useState(false)
  const [editingAthlete, setEditingAthlete] = useState<Athlete | null>(null)

  const { data, isLoading } = useAthletes({
    search: search || undefined,
    status: showArchived ? undefined : 'active',
    limit: pageSize,
    offset: pageIndex * pageSize,
  })

  // ... handlers for edit, archive, invite

  return (
    <div className="space-y-4">
      <DataTable.Root {...tableProps}>
        <DataTable.Toolbar>
          <DataTable.Search value={search} onValueChange={setSearch} />
          {/* Show archived toggle */}
          <Button onClick={() => setDrawerOpen(true)}>Add Athlete</Button>
        </DataTable.Toolbar>
        <DataTable.Content />
        <DataTable.Pagination />
      </DataTable.Root>

      <Sheet open={drawerOpen} onOpenChange={setDrawerOpen}>
        {/* AthleteForm */}
      </Sheet>
    </div>
  )
}
```
  </action>
  <verify>
Navigate to /athletes route and verify the list loads, search works, and form opens in drawer.
  </verify>
  <done>
Athletes list view displays data, search filters, and drawer form creates/edits athletes.
  </done>
</task>

</tasks>

<verification>
1. Run `pnpm typecheck` - no errors
2. Run `pnpm lint` - no errors
3. Navigate to /athletes
4. Verify list loads with pagination
5. Verify search filters results
6. Verify "Add Athlete" opens drawer with form
7. Verify form validates and submits
8. Verify edit populates form with existing data
9. Verify archive shows confirmation and updates list
10. Verify invitation generates link and copies to clipboard
</verification>

<success_criteria>
- Athletes list loads with pagination (10 per page default)
- Search debounces and filters athletes by name
- Show archived toggle filters/shows archived athletes
- Add Athlete button opens drawer with empty form
- Form validates required fields (name)
- Create athlete submits and refreshes list
- Edit athlete populates form and updates on submit
- Archive athlete removes from active list
- Generate invitation copies link to clipboard with toast
- Invitation status badge shows correct state
- No TypeScript or lint errors
</success_criteria>

<output>
After completion, create `.planning/phases/02.5-coach-web-foundation/02.5-04-SUMMARY.md`
</output>
