---
phase: 02.5-coach-web-foundation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/coach-web/src/components/data-table/data-table.tsx
  - apps/coach-web/src/components/data-table/data-table-pagination.tsx
  - apps/coach-web/src/components/data-table/data-table-search.tsx
  - apps/coach-web/src/components/data-table/data-table-toolbar.tsx
  - apps/coach-web/src/components/data-table/data-table-row-actions.tsx
  - apps/coach-web/src/hooks/use-debounce.ts
autonomous: true

must_haves:
  truths:
    - "DataTable renders with column definitions and data array"
    - "Pagination shows page numbers and items-per-page selector"
    - "Search input debounces and calls onSearchChange callback"
    - "Row actions dropdown renders with custom actions"
    - "DataTable supports server-side pagination via totalCount and onPageChange"
  artifacts:
    - path: "apps/coach-web/src/components/data-table/data-table.tsx"
      provides: "Main DataTable compound component"
      min_lines: 50
    - path: "apps/coach-web/src/components/data-table/data-table-pagination.tsx"
      provides: "Pagination component with page numbers"
      min_lines: 30
    - path: "apps/coach-web/src/components/data-table/data-table-search.tsx"
      provides: "Debounced search input"
      min_lines: 20
  key_links:
    - from: "apps/coach-web/src/components/data-table/data-table.tsx"
      to: "components/ui/table.tsx"
      via: "shadcn Table components"
      pattern: "import.*Table.*from"
---

<objective>
Create a reusable DataTable compound component with server-side pagination, search, and row actions.

Purpose: Both Athletes and Exercises pages need data tables with similar functionality. Building this first enables parallel work on those features.
Output: DataTable compound component that can be composed with Toolbar, Search, Pagination, and RowActions.
</objective>

<execution_context>
@/Users/tomiardz/.claude/get-shit-done/workflows/execute-plan.md
@/Users/tomiardz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/02.5-coach-web-foundation/02.5-CONTEXT.md
@.planning/phases/02.5-coach-web-foundation/02.5-RESEARCH.md
@apps/coach-web/src/components/ui/table.tsx
@apps/coach-web/src/components/ui/dropdown-menu.tsx
@apps/coach-web/src/components/ui/input.tsx
@apps/coach-web/src/components/ui/button.tsx
@apps/coach-web/src/components/ui/select.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DataTable core and pagination</name>
  <skills>/data-table</skills>
  <files>
    apps/coach-web/src/components/data-table/data-table.tsx
    apps/coach-web/src/components/data-table/data-table-pagination.tsx
    apps/coach-web/src/hooks/use-debounce.ts
  </files>
  <action>
Create the core DataTable component with TanStack Table:

1. Create `hooks/use-debounce.ts`:
   - Custom hook that debounces a value by specified delay (default 300ms)
   - Returns the debounced value
   - Clean up timeout on unmount

2. Create `components/data-table/data-table.tsx`:
   - Use TanStack Table (useReactTable) for table logic
   - Accept generic TData type for row data
   - Props: columns (ColumnDef[]), data (TData[]), totalCount, pageIndex, pageSize, onPageChange, isLoading
   - Configure for manual pagination (manualPagination: true)
   - Render using shadcn Table, TableHeader, TableBody, TableRow, TableCell
   - Show loading skeleton when isLoading is true (use Skeleton component)
   - Show empty state when data.length === 0 and not loading
   - Compound component pattern: DataTable.Root, DataTable.Toolbar, DataTable.Content, DataTable.Pagination

3. Create `components/data-table/data-table-pagination.tsx`:
   - Show page numbers with ellipsis for large page counts
   - Items per page selector with options: 10, 25, 50, 100
   - Previous/Next buttons
   - Show "Showing X to Y of Z results" text
   - Accept table instance and onPageChange callback
   - Use shadcn Select for items-per-page dropdown
   - Use shadcn Button for pagination controls
   - Use ChevronLeft, ChevronRight icons from lucide-react

Pattern for compound component:
```typescript
type DataTableProps<TData> = {
  columns: ColumnDef<TData>[]
  data: TData[]
  totalCount: number
  pageIndex: number
  pageSize: number
  onPageChange: (pageIndex: number, pageSize: number) => void
  isLoading?: boolean
  children?: React.ReactNode
}

function DataTableRoot<TData>({ children, ...props }: DataTableProps<TData>) {
  const table = useReactTable({...})
  return (
    <DataTableContext.Provider value={{ table, ...props }}>
      {children}
    </DataTableContext.Provider>
  )
}
```
  </action>
  <verify>
Run `pnpm typecheck` to verify no TypeScript errors. Import DataTable in a test component to verify exports work.
  </verify>
  <done>
DataTable renders table with data and pagination controls work correctly.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create DataTable search and toolbar</name>
  <skills>/data-table</skills>
  <files>
    apps/coach-web/src/components/data-table/data-table-search.tsx
    apps/coach-web/src/components/data-table/data-table-toolbar.tsx
  </files>
  <action>
Create the toolbar and search components:

1. Create `components/data-table/data-table-search.tsx`:
   - Input component with search icon (Search from lucide-react)
   - Debounced value using use-debounce hook
   - Props: value, onValueChange, placeholder
   - On debounced value change, call onValueChange
   - Clear button (X icon) when value is not empty
   - Use shadcn Input with InputGroup for icon placement

2. Create `components/data-table/data-table-toolbar.tsx`:
   - Flex container for toolbar items
   - Slot for left side (search, filters)
   - Slot for right side (actions like "Add new")
   - Props: children (slot content)
   - Simple flex layout with gap-4

Pattern for search:
```typescript
export function DataTableSearch({
  value,
  onValueChange,
  placeholder = "Search...",
}: DataTableSearchProps) {
  const [inputValue, setInputValue] = useState(value)
  const debouncedValue = useDebounce(inputValue, 300)

  useEffect(() => {
    if (debouncedValue !== value) {
      onValueChange(debouncedValue)
    }
  }, [debouncedValue, onValueChange, value])

  return (
    <InputGroup>
      <InputGroupText><Search className="h-4 w-4" /></InputGroupText>
      <Input
        value={inputValue}
        onChange={(e) => setInputValue(e.target.value)}
        placeholder={placeholder}
      />
    </InputGroup>
  )
}
```
  </action>
  <verify>
Verify that DataTableSearch debounces input correctly by adding console.log to onValueChange and typing quickly.
  </verify>
  <done>
Search input debounces and toolbar provides layout slots for filters and actions.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create DataTable row actions</name>
  <skills>/data-table</skills>
  <files>
    apps/coach-web/src/components/data-table/data-table-row-actions.tsx
  </files>
  <action>
Create the row actions dropdown component:

1. Create `components/data-table/data-table-row-actions.tsx`:
   - DropdownMenu with three-dot trigger button (MoreHorizontal icon)
   - Accept actions array with: label, icon (optional), onClick, variant (default/destructive)
   - Render DropdownMenuItem for each action
   - Separator before destructive actions
   - Button trigger is ghost variant, icon-only

Props type:
```typescript
type RowAction<TData> = {
  label: string
  icon?: React.ComponentType<{ className?: string }>
  onClick: (row: TData) => void
  variant?: 'default' | 'destructive'
}

type DataTableRowActionsProps<TData> = {
  row: TData
  actions: RowAction<TData>[]
}
```

Example usage:
```typescript
<DataTableRowActions
  row={athlete}
  actions={[
    { label: 'Edit', icon: Pencil, onClick: (row) => openEdit(row) },
    { label: 'Archive', icon: Archive, onClick: (row) => archive(row), variant: 'destructive' },
  ]}
/>
```
  </action>
  <verify>
Run `pnpm typecheck` to verify the component has correct typing.
  </verify>
  <done>
Row actions dropdown renders with configurable actions and correct styling.
  </done>
</task>

</tasks>

<verification>
1. Run `pnpm typecheck` - no errors
2. Run `pnpm lint` - no errors
3. Import DataTable in a test route and render with mock data
4. Verify pagination controls update page index
5. Verify search debounces correctly (300ms delay)
6. Verify row actions dropdown opens and shows actions
</verification>

<success_criteria>
- DataTable renders table with columns and data
- Pagination shows correct page numbers and allows page changes
- Items per page selector works with 10, 25, 50, 100 options
- Search input debounces at 300ms
- Row actions dropdown shows actions with icons
- Loading state shows skeleton rows
- Empty state shows message when no data
- No TypeScript or lint errors
</success_criteria>

<output>
After completion, create `.planning/phases/02.5-coach-web-foundation/02.5-02-SUMMARY.md`
</output>
