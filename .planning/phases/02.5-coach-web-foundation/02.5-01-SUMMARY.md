# Phase 02.5-01: App Shell Foundation - Summary

**Status:** ✅ Complete
**Completed:** 2026-01-24

## What Was Built

Implemented the foundational app shell for the coach-web application with authentication guards, layout components, and theme support.

### Routes Created

1. **Root Route** (`routes/__root.tsx`)
   - QueryClientProvider wraps entire app
   - ThemeProvider for dark/light mode support
   - TanStack Router Devtools in development

2. **Authenticated Layout** (`routes/_authenticated.tsx`)
   - Auth guard with `beforeLoad` hook
   - Redirects unauthenticated users to `/login`
   - Passes auth data to AppShell

3. **Auth Layout** (`routes/_auth.tsx`)
   - Reverse guard - redirects authenticated users to `/dashboard`
   - Minimal wrapper for login/signup pages

4. **Placeholder Routes**
   - `routes/_authenticated/dashboard.tsx` - Dashboard placeholder
   - `routes/_auth/login.tsx` - Login page placeholder
   - `routes/index.tsx` - Root redirect to dashboard

### Layout Components

1. **AppShell** (`components/layout/app-shell.tsx`)
   - Main layout wrapper with sidebar + content area
   - Top bar with sidebar trigger, breadcrumbs, and user menu
   - Uses shadcn/ui SidebarProvider

2. **AppSidebar** (`components/layout/app-sidebar.tsx`)
   - Collapsible sidebar with navigation
   - Nav items: Dashboard, Athletes, Exercises
   - Active state tracking with TanStack Router
   - Collapse state persists in localStorage (via shadcn sidebar)

3. **UserMenu** (`components/layout/user-menu.tsx`)
   - Avatar with user initials
   - Dropdown with Settings, Theme toggle, Logout
   - Theme submenu (Light, Dark, System)
   - Logout redirects to login

4. **Breadcrumbs** (`components/layout/breadcrumbs.tsx`)
   - Auto-generated from current route path
   - Links to parent routes
   - Route label mapping

### Theme System

**ThemeProvider** (`lib/theme.tsx`)
- React context for theme state
- Supports 'light', 'dark', 'system' modes
- Persists theme in localStorage
- Applies theme to `data-theme` attribute on `<html>`
- Watches system preference changes when in 'system' mode

## Files Created

```
apps/coach-web/src/
├── routes/
│   ├── __root.tsx                    # Root layout with providers
│   ├── _authenticated.tsx            # Auth guard layout
│   ├── _auth.tsx                     # Reverse auth guard
│   ├── _authenticated/
│   │   └── dashboard.tsx             # Dashboard placeholder
│   ├── _auth/
│   │   └── login.tsx                 # Login placeholder
│   └── index.tsx                     # Root redirect
├── components/layout/
│   ├── app-shell.tsx                 # Main app layout
│   ├── app-sidebar.tsx               # Navigation sidebar
│   ├── user-menu.tsx                 # User dropdown menu
│   └── breadcrumbs.tsx               # Route breadcrumbs
└── lib/
    └── theme.tsx                     # Theme provider & hook
```

## Technical Details

### Auth Flow
1. User navigates to protected route (e.g., `/dashboard`)
2. `_authenticated` layout's `beforeLoad` runs
3. Calls `authClient.getSession()`
4. If no session, redirects to `/login`
5. If session exists, passes `{ user, session }` to context
6. AppShell receives auth data and renders

### Theme System
- Initial theme read from `localStorage` on mount
- Defaults to 'system' if not set
- System theme detection via `prefers-color-scheme` media query
- Theme changes update both state and localStorage
- `data-theme` attribute on `<html>` enables CSS variable switching

### Sidebar State
- Collapse state managed by shadcn/ui SidebarProvider
- Persists to cookie via `sidebar_state` (built into shadcn sidebar)
- Keyboard shortcut: `Cmd/Ctrl + B` toggles sidebar
- Mobile: Sidebar becomes a sheet overlay

## Verification

✅ `pnpm typecheck` passes with no errors
✅ Dev server starts successfully
✅ Routes are properly registered in routeTree.gen.ts
✅ Auth guards work (tested by checking redirect logic)
✅ Sidebar navigation items render
✅ Theme toggle works (verified localStorage + data-theme attribute)

## Dependencies Used

All dependencies were already installed:
- `@tanstack/react-router` - File-based routing with beforeLoad guards
- `@tanstack/react-query` - Server state management
- `better-auth/react` - Authentication client
- `lucide-react` - Icons for navigation and UI
- `shadcn/ui` components:
  - Sidebar primitives
  - Dropdown Menu
  - Avatar
  - Breadcrumb
  - Separator

## Known Issues

1. **Placeholder Routes**: Dashboard and login are minimal placeholders. Full implementations will come in subsequent phases.
2. **No Error Boundaries**: App doesn't have error boundaries yet. Will add in error handling phase.
3. **No Loading States**: Auth checks don't show loading UI. Will add skeleton states later.

## Next Steps

**Phase 02.5-02** should implement:
1. Full login/signup forms with Better Auth integration
2. Organization selection after login
3. Error handling and loading states
4. Athletes list page (replacing dashboard placeholder)
5. Exercises browser page

## Notes

- Used `data-theme` attribute instead of class-based theme switching for better CSS variable support
- Sidebar uses shadcn's built-in state management instead of custom localStorage logic
- Auth data structure from Better Auth is `{ user, session }`, not just session
- TanStack Router requires child routes to exist for layout routes to work properly
- Type errors for routes resolved by creating placeholder pages
