---
phase: 02.5-coach-web-foundation
plan: 09
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/contracts/src/athletes/athlete.ts
  - apps/coach-web/src/features/athletes/views/athletes-list-view.tsx
  - apps/coach-web/src/features/athletes/components/athlete-form.tsx
  - apps/coach-web/src/components/ui/sheet.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Form validation shows user-friendly error messages, not default Zod text"
    - "Sheet content has proper padding on all sides"
    - "Sheet footer is positioned at bottom with form buttons"
    - "Sheet body content is scrollable if it overflows"
  artifacts:
    - path: "packages/contracts/src/athletes/athlete.ts"
      provides: "Custom error messages on validation rules"
      pattern: "message:.*required|at least"
    - path: "apps/coach-web/src/features/athletes/views/athletes-list-view.tsx"
      provides: "Form using SheetFooter for buttons"
      contains: "SheetFooter"
    - path: "apps/coach-web/src/components/ui/sheet.tsx"
      provides: "Sheet with proper content padding and scrollable body"
      pattern: "overflow.*scroll|px-"
  key_links:
    - from: "athlete-form.tsx"
      to: "@strenly/contracts"
      via: "zodResolver with schema that has custom messages"
    - from: "athletes-list-view.tsx"
      to: "sheet.tsx"
      via: "SheetFooter containing form buttons"
---

<objective>
Polish forms with custom error messages and proper Sheet styling

Purpose: Forms show default Zod validation messages like "String must contain at least 1 character(s)" instead of user-friendly messages. The Sheet component lacks proper content padding and the form buttons should be in SheetFooter.

Output: Professional form UX with clear error messages and proper drawer layout
</objective>

<execution_context>
@/Users/tomiardz/.claude/get-shit-done/workflows/execute-plan.md
@/Users/tomiardz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02.5-coach-web-foundation/02.5-UAT.md

# Key files
@packages/contracts/src/athletes/athlete.ts
@apps/coach-web/src/features/athletes/views/athletes-list-view.tsx
@apps/coach-web/src/features/athletes/components/athlete-form.tsx
@apps/coach-web/src/components/ui/sheet.tsx

# Skill reference
# /form skill - for form patterns
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add custom error messages to athlete contracts</name>
  <files>packages/contracts/src/athletes/athlete.ts</files>
  <action>
**Root cause:** The Zod schemas use default error messages. When validation fails, users see cryptic messages like "String must contain at least 1 character(s)".

**Add custom messages to createAthleteInputSchema:**

```typescript
export const createAthleteInputSchema = z.object({
  name: z.string()
    .min(1, { message: 'Name is required' })
    .max(100, { message: 'Name must be 100 characters or less' }),
  email: z.string()
    .email({ message: 'Please enter a valid email address' })
    .optional()
    .or(z.literal('')),  // Allow empty string to be treated as undefined
  phone: z.string()
    .optional()
    .or(z.literal('')),
  birthdate: z.string()
    .optional()
    .or(z.literal('')),
  gender: genderSchema.optional(),
  notes: z.string()
    .max(1000, { message: 'Notes must be 1000 characters or less' })
    .optional()
    .or(z.literal('')),
})
```

**Key changes:**
1. Add `{ message: '...' }` to all validation rules
2. Use `.or(z.literal(''))` for optional string fields to handle empty form inputs
3. Make messages user-friendly and clear

**Also update listAthletesInputSchema if it has validation rules:**
```typescript
export const listAthletesInputSchema = z.object({
  status: athleteStatusSchema.optional(),
  search: z.string().optional(),
  limit: z.number()
    .min(1, { message: 'Limit must be at least 1' })
    .max(100, { message: 'Limit cannot exceed 100' })
    .optional(),
  offset: z.number()
    .min(0, { message: 'Offset cannot be negative' })
    .optional(),
})
```
  </action>
  <verify>
1. Run `pnpm typecheck` in packages/contracts to ensure schema is valid
2. In browser, try to create athlete with empty name
3. Verify error message shows "Name is required" not "String must contain at least 1 character(s)"
  </verify>
  <done>
- Name field shows "Name is required" when empty
- Email field shows "Please enter a valid email address" when invalid
- All validation messages are user-friendly English sentences
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix Sheet styling and form button placement</name>
  <files>
    apps/coach-web/src/components/ui/sheet.tsx
    apps/coach-web/src/features/athletes/views/athletes-list-view.tsx
    apps/coach-web/src/features/athletes/components/athlete-form.tsx
  </files>
  <action>
**Issues to fix:**
1. Sheet content lacks horizontal padding (user reported "no side padding")
2. Form buttons not in SheetFooter (should stick to bottom)
3. Sheet body should be scrollable if content overflows

**Fix 1: Update SheetContent in sheet.tsx**

The SheetContent wrapper needs a scrollable body area. Create a SheetBody component:

```typescript
function SheetBody({ className, ...props }: React.ComponentProps<'div'>) {
  return (
    <div
      data-slot="sheet-body"
      className={cn('flex-1 overflow-y-auto px-4', className)}
      {...props}
    />
  )
}

// Export it
export { Sheet, SheetTrigger, SheetClose, SheetContent, SheetHeader, SheetBody, SheetFooter, SheetTitle, SheetDescription }
```

**Fix 2: Restructure athletes-list-view.tsx Sheet usage**

Move form buttons OUT of AthleteForm and INTO SheetFooter:

```tsx
<Sheet open={drawerOpen} onOpenChange={setDrawerOpen}>
  <SheetContent>
    <SheetHeader>
      <SheetTitle>{editingAthlete ? 'Edit athlete' : 'Add new athlete'}</SheetTitle>
      <SheetDescription>
        {editingAthlete
          ? 'Update athlete information and generate invitations to the athlete app.'
          : 'Create a new athlete profile. You can invite them to the athlete app later.'}
      </SheetDescription>
    </SheetHeader>
    <SheetBody>
      <AthleteForm
        id="athlete-form"
        onSubmit={handleFormSubmit}
        isSubmitting={isSubmitting}
        defaultValues={editingAthlete ? { ... } : undefined}
      />
    </SheetBody>
    <SheetFooter>
      <Button type="button" variant="outline" onClick={handleFormCancel} disabled={isSubmitting}>
        Cancel
      </Button>
      <Button type="submit" form="athlete-form" disabled={isSubmitting}>
        {isSubmitting ? 'Saving...' : editingAthlete ? 'Update athlete' : 'Create athlete'}
      </Button>
    </SheetFooter>
  </SheetContent>
</Sheet>
```

**Fix 3: Update AthleteForm to support external buttons**

Modify athlete-form.tsx to:
1. Accept an `id` prop to link with external submit button
2. Remove the internal button row
3. Keep the form tag with the id

```tsx
type AthleteFormProps = {
  id?: string  // Form ID for external submit button
  onSubmit: (data: CreateAthleteInput) => void
  isSubmitting: boolean
  defaultValues?: Partial<CreateAthleteInput>
}

export function AthleteForm({ id, onSubmit, isSubmitting, defaultValues }: AthleteFormProps) {
  const {
    register,
    handleSubmit,
    formState: { errors },
    setValue,
    watch,
  } = useForm<CreateAthleteInput>({
    resolver: zodResolver(createAthleteInputSchema),
    defaultValues,
  })

  const genderValue = watch('gender')

  return (
    <form id={id} onSubmit={handleSubmit(onSubmit)} className="flex flex-col gap-6">
      {/* ... all the Field components, NO buttons at the end ... */}
    </form>
  )
}
```

**Pattern explanation:** Using `form="athlete-form"` on the submit Button links it to the form by ID. This allows buttons in SheetFooter to submit the form in SheetBody.
  </action>
  <verify>
1. Open the Add Athlete drawer
2. Verify content has proper horizontal padding (not edge-to-edge)
3. Verify footer with Cancel/Create buttons is at bottom
4. Add lots of content (notes) to test scrolling - body should scroll, footer should stay fixed
5. Submit form to ensure button still works
  </verify>
  <done>
- Sheet content has padding on left and right sides
- Form buttons are in fixed footer at bottom
- Sheet body scrolls when content overflows
- Form submission still works via external button
  </done>
</task>

</tasks>

<verification>
1. Create athlete with empty name - shows "Name is required"
2. Create athlete with invalid email - shows "Please enter a valid email address"
3. Sheet drawer has proper horizontal padding
4. Cancel and Create buttons are pinned at bottom in footer
5. Form scrolls if content is tall, buttons stay visible
6. Form submission works correctly
</verification>

<success_criteria>
- All validation messages are user-friendly English
- Sheet layout follows proper structure (Header, Body, Footer)
- Body content scrolls, footer stays fixed
- Form buttons work from SheetFooter position
- Test 8 (create athlete UX) fully resolved
</success_criteria>

<output>
After completion, create `.planning/phases/02.5-coach-web-foundation/02.5-09-SUMMARY.md`
</output>
