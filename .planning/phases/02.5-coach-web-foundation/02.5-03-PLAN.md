---
phase: 02.5-coach-web-foundation
plan: 03
type: execute
wave: 2
depends_on: ["02.5-01"]
files_modified:
  - apps/coach-web/src/routes/_auth/login.tsx
  - apps/coach-web/src/routes/_auth/signup.tsx
  - apps/coach-web/src/routes/_auth/onboarding.tsx
  - apps/coach-web/src/features/auth/views/login-view.tsx
  - apps/coach-web/src/features/auth/views/signup-view.tsx
  - apps/coach-web/src/features/auth/views/onboarding-view.tsx
  - apps/coach-web/src/features/auth/components/auth-layout.tsx
  - apps/coach-web/src/features/auth/components/oauth-buttons.tsx
  - apps/coach-web/src/features/auth/components/login-form.tsx
  - apps/coach-web/src/features/auth/components/signup-form.tsx
  - apps/coach-web/src/features/auth/components/org-form.tsx
autonomous: true

must_haves:
  truths:
    - "User can sign up with email/password via form"
    - "User can sign up with Google OAuth: button click redirects to Google, callback completes auth flow"
    - "User can log in with email/password"
    - "User can log out via user menu"
    - "User can create organization during onboarding and active org is set"
    - "Auth errors display as toast or inline error"
  artifacts:
    - path: "apps/coach-web/src/routes/_auth/login.tsx"
      provides: "Login route"
      contains: "createFileRoute"
    - path: "apps/coach-web/src/features/auth/views/login-view.tsx"
      provides: "Login view with form"
      min_lines: 40
    - path: "apps/coach-web/src/features/auth/components/auth-layout.tsx"
      provides: "Split-screen auth layout"
      min_lines: 30
  key_links:
    - from: "apps/coach-web/src/features/auth/views/login-view.tsx"
      to: "lib/auth-client.ts"
      via: "signIn call"
      pattern: "signIn\\("
    - from: "apps/coach-web/src/features/auth/views/onboarding-view.tsx"
      to: "lib/auth-client.ts"
      via: "organization.create"
      pattern: "organization\\.create"
    - from: "apps/coach-web/src/features/auth/views/onboarding-view.tsx"
      to: "lib/auth-client.ts"
      via: "organization.setActive to set current org"
      pattern: "organization\\.setActive"
    - from: "apps/coach-web/src/features/auth/components/oauth-buttons.tsx"
      to: "lib/auth-client.ts"
      via: "signIn.social for Google OAuth"
      pattern: "signIn\\.social.*google"
---

<objective>
Create the authentication UI: login, signup, and onboarding flows with organization creation.

Purpose: Users need to authenticate before using the app. This is the entry point for all users.
Output: Complete auth flow from signup/login through organization creation to dashboard.
</objective>

<execution_context>
@/Users/tomiardz/.claude/get-shit-done/workflows/execute-plan.md
@/Users/tomiardz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/02.5-coach-web-foundation/02.5-CONTEXT.md
@.planning/phases/02.5-coach-web-foundation/02.5-RESEARCH.md
@apps/coach-web/src/lib/auth-client.ts
@apps/coach-web/src/routes/_auth.tsx
@apps/coach-web/src/components/ui/button.tsx
@apps/coach-web/src/components/ui/input.tsx
@apps/coach-web/src/components/ui/field.tsx
@apps/coach-web/src/components/ui/card.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create auth layout and shared components</name>
  <skills></skills>
  <files>
    apps/coach-web/src/features/auth/components/auth-layout.tsx
    apps/coach-web/src/features/auth/components/oauth-buttons.tsx
  </files>
  <action>
Create the auth layout and OAuth button components:

1. Create `features/auth/components/auth-layout.tsx`:
   - Split-screen layout: logo/tagline on left, form on right
   - Left panel: bg-primary, centered content, hidden on mobile (lg:flex)
   - Logo placeholder (use Dumbbell icon from lucide-react for now)
   - Tagline: "Strenly" heading + "Crea programas de entrenamiento tan rapido como en Excel" subtext
   - Right panel: flex column, centered, max-w-md form container
   - Children slot for form content

2. Create `features/auth/components/oauth-buttons.tsx`:
   - Google OAuth button (primary, full width)
   - Show spinner when loading
   - Only render if isGoogleOAuthEnabled from auth-client.ts
   - Call authClient.signIn.social({ provider: 'google' })
   - Handle error with toast notification
   - "Or" divider below (flex with borders and text)

Layout pattern from CONTEXT:
```typescript
export function AuthLayout({ children }: { children: React.ReactNode }) {
  return (
    <div className="min-h-screen grid lg:grid-cols-2">
      <div className="hidden lg:flex flex-col justify-center items-center bg-primary p-12">
        {/* Branding */}
      </div>
      <div className="flex flex-col justify-center items-center p-8 lg:p-12">
        <div className="w-full max-w-md space-y-6">
          {children}
        </div>
      </div>
    </div>
  )
}
```
  </action>
  <verify>
Run `pnpm typecheck` to verify components compile correctly.
  </verify>
  <done>
Auth layout renders split-screen and OAuth buttons render conditionally.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create login and signup forms and views</name>
  <skills>/form</skills>
  <files>
    apps/coach-web/src/features/auth/components/login-form.tsx
    apps/coach-web/src/features/auth/components/signup-form.tsx
    apps/coach-web/src/features/auth/views/login-view.tsx
    apps/coach-web/src/features/auth/views/signup-view.tsx
    apps/coach-web/src/routes/_auth/login.tsx
    apps/coach-web/src/routes/_auth/signup.tsx
  </files>
  <action>
Create login and signup forms with their routes:

1. Create `features/auth/components/login-form.tsx`:
   - Use React Hook Form with email and password fields
   - Email: type="email", required
   - Password: type="password", required
   - "Remember me" checkbox
   - Submit button with loading spinner
   - Props: onSubmit, isLoading
   - Use Field, FieldLabel, FieldError from components/ui/field

2. Create `features/auth/components/signup-form.tsx`:
   - Use React Hook Form with name, email, password fields
   - Name: min 2 chars
   - Email: valid email format
   - Password: min 8 chars
   - Submit button with loading spinner
   - Props: onSubmit, isLoading

3. Create `features/auth/views/login-view.tsx`:
   - AuthLayout wrapper
   - OAuthButtons at top (if enabled)
   - LoginForm
   - Handle signIn.email({ email, password, rememberMe })
   - On success: check if user has organizations, redirect to /dashboard or /onboarding
   - On error: show toast with error message
   - Link to signup: "Don't have an account? Sign up"

4. Create `features/auth/views/signup-view.tsx`:
   - AuthLayout wrapper
   - OAuthButtons at top (if enabled)
   - SignupForm
   - Handle signUp.email({ email, password, name })
   - On success: redirect to /onboarding (new users need to create org)
   - On error: show toast with error message
   - Link to login: "Already have an account? Log in"

5. Create thin route files:
   - `routes/_auth/login.tsx`: createFileRoute, component: LoginView
   - `routes/_auth/signup.tsx`: createFileRoute, component: SignupView

Auth client usage:
```typescript
const { error } = await signIn.email({
  email: data.email,
  password: data.password,
  rememberMe: data.rememberMe,
})
if (error) {
  toast.error(error.message ?? 'Error signing in')
  return
}
// Check for orgs and redirect
const orgs = await authClient.organization.list()
if (orgs.data?.length) {
  navigate({ to: '/dashboard' })
} else {
  navigate({ to: '/onboarding' })
}
```
  </action>
  <verify>
Navigate to /login and /signup routes and verify forms render correctly.
  </verify>
  <done>
Login and signup forms submit and handle auth correctly with proper redirects.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create onboarding view with org creation</name>
  <skills>/form</skills>
  <files>
    apps/coach-web/src/features/auth/components/org-form.tsx
    apps/coach-web/src/features/auth/views/onboarding-view.tsx
    apps/coach-web/src/routes/_auth/onboarding.tsx
  </files>
  <action>
Create the onboarding flow for organization creation:

1. Create `features/auth/components/org-form.tsx`:
   - Organization name input (required, min 2 chars, max 50 chars)
   - Slug input (auto-generated from name, editable)
   - Slug validation: lowercase, alphanumeric, hyphens only
   - Submit button "Create Organization"
   - Props: onSubmit, isLoading

2. Create `features/auth/views/onboarding-view.tsx`:
   - AuthLayout wrapper
   - Welcome message with user's name from session
   - OrgForm component
   - Handle organization creation via authClient.organization.create({ name, slug })
   - On success: set active org and redirect to /dashboard
   - On error: show toast with error message
   - Skip link for users who want to join existing org (show text only for now)

3. Create thin route:
   - `routes/_auth/onboarding.tsx`: createFileRoute, component: OnboardingView
   - Add beforeLoad to verify user is authenticated (redirect to /login if not)
   - This is a special route - user is authenticated but doesn't have an org yet

Org creation flow:
```typescript
const result = await authClient.organization.create({
  name: data.name,
  slug: data.slug,
})
if (result.error) {
  toast.error(result.error.message ?? 'Error creating organization')
  return
}
// Set as active organization
await authClient.organization.setActive({ organizationId: result.data.id })
navigate({ to: '/dashboard' })
```

Slug generation from name:
```typescript
const generateSlug = (name: string) => {
  return name
    .toLowerCase()
    .replace(/[^a-z0-9]+/g, '-')
    .replace(/^-|-$/g, '')
}
```
  </action>
  <verify>
Navigate to /onboarding (after login) and verify organization creation works.
  </verify>
  <done>
User can create organization during onboarding and is redirected to dashboard.
  </done>
</task>

</tasks>

<verification>
1. Run `pnpm typecheck` - no errors
2. Run `pnpm lint` - no errors
3. Test login flow: /login -> enter credentials -> redirect to dashboard/onboarding
4. Test signup flow: /signup -> enter info -> redirect to /onboarding
5. Test onboarding: /onboarding -> create org -> org.setActive called -> redirect to /dashboard
6. Test OAuth button visibility based on VITE_GOOGLE_OAUTH_ENABLED
7. Test Google OAuth flow (AUTH-02): Click Google button -> redirects to Google -> callback URL handles auth -> user session created -> redirect to dashboard/onboarding
8. Test logout from user menu -> redirect to /login
</verification>

<success_criteria>
- Login form validates and submits correctly
- Signup form validates and creates new user
- Onboarding creates organization with auto-generated slug
- Auth errors show as toast notifications
- OAuth buttons only show when enabled
- Successful auth redirects to correct destination
- Split-screen layout renders correctly on desktop
- No TypeScript or lint errors
</success_criteria>

<output>
After completion, create `.planning/phases/02.5-coach-web-foundation/02.5-03-SUMMARY.md`
</output>
