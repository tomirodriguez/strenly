---
status: diagnosed
phase: 02.5-coach-web-foundation
source: 02.5-01-SUMMARY.md, 02.5-02-SUMMARY.md, 02.5-03-SUMMARY.md, 02.5-04-SUMMARY.md, 02.5-05-SUMMARY.md, 02.5-06-SUMMARY.md
started: 2026-01-24T08:00:00Z
updated: 2026-01-24T10:00:00Z
---

## Current Test

[testing complete]

## Tests

### 1. Sign Up Flow
expected: Navigate to /signup. Create account with name/email/password. After signup, complete onboarding by creating organization. End up at /dashboard.
result: issue
reported: "I could create the account, no onboarding appear. It just redirects me to the dashboard. Also saw bunch of internal errors: POST /rpc/athletes/list 500 Internal Server Error. Another thing is that the sign up form and login form dont use zod or hookform as the skill explicitly says. That was mandatory."
severity: blocker

### 2. Login Flow
expected: Navigate to /login. Enter email and password. After login, redirect to /dashboard (if organization exists) or /onboarding (if no organization).
result: issue
reported: "Can't log out. Clicking the chip causes error: Base UI MenuGroupRootContext is missing. Menu group parts must be used within <Menu.Group>. Forms still don't follow /form skill pattern based on shadcn React Hook Form."
severity: blocker

### 3. Dashboard Stats
expected: Dashboard shows three stat cards: Total Athletes, Active Athletes, and Pending Invitations with actual counts from your data.
result: issue
reported: "Shows the three cards, but the queries throw Internal Server Error so they have no data"
severity: major

### 4. Dashboard Quick Actions
expected: Dashboard has "Manage Athletes" and "Browse Exercises" links that navigate to /athletes and /exercises respectively.
result: issue
reported: "Manage Athletes redirects good. Browse Exercises navigates but exercises page crashes: Error: DataTable components must be used within DataTable.Root"
severity: blocker

### 5. Theme Toggle
expected: Click user menu (avatar in top bar). Select Theme submenu. Toggle between Light, Dark, and System modes. Theme changes immediately and persists after page refresh.
result: issue
reported: "No place to toggle the theme - feature is missing"
severity: major

### 6. Sidebar Navigation
expected: Sidebar shows Dashboard, Athletes, Exercises navigation items. Clicking each navigates to the correct page. Active item is highlighted. Sidebar can be collapsed with Cmd/Ctrl+B.
result: pass

### 7. Athletes List
expected: /athletes shows a table with athlete names, emails, status, and invitation status. Search input filters athletes by name/email. Pagination works at bottom.
result: issue
reported: "Doesn't work - get error 500 when fetching"
severity: blocker

### 8. Create Athlete
expected: Click "Add Athlete" button. Drawer opens with form (name, email, phone, birthdate, gender, notes). Fill and submit. New athlete appears in list. Success toast shown.
result: issue
reported: "Drawer styling bad - no side padding, footer not at bottom, body should be scrollable. Error messages show default Zod text like 'String must contain at least 1 character(s)'. Email marked optional but validation requires it. Can't save - 500 error with 'Organization no encontrada', error mapping wrong (shouldn't be 500)."
severity: blocker

### 9. Archive Athlete
expected: Click three-dot menu on an athlete row. Select Archive. Confirmation dialog appears. Confirm. Athlete disappears from list (or shows as inactive with "Show archived" toggle).
result: skipped
reason: Can't test - athletes endpoint returns 500 errors

### 10. Generate Invitation
expected: Click three-dot menu on an athlete row. Select "Generate Invite". Success toast confirms link copied to clipboard. You can paste the link.
result: skipped
reason: Can't test - can't create athletes due to 500 errors

### 11. Exercises Browser
expected: /exercises shows a table of exercises with Name, Muscles, Pattern, Type columns. Muscle badges show primary (solid) and secondary (outline) muscles.
result: issue
reported: "Exercises table doesn't work - crashes with DataTable.Root context error (same as test 4)"
severity: blocker

### 12. Exercises Filters
expected: Muscle group dropdown filters exercises by selected muscle. Movement pattern dropdown filters by pattern. Search filters by exercise name. Filters can be combined.
result: skipped
reason: Can't test - exercises table crashes with DataTable.Root error

### 13. Logout
expected: Click user menu. Select Logout. Redirected to /login page. Cannot access /dashboard without logging in again.
result: issue
reported: "User chip not working - can't access user menu (same MenuGroupRootContext error as test 2)"
severity: blocker

## Summary

total: 13
passed: 1
issues: 9
pending: 0
skipped: 3

## Gaps

- truth: "After signup, user is redirected to /onboarding to create organization, then to /dashboard"
  status: failed
  reason: "User reported: No onboarding appeared after signup - redirected directly to dashboard. Multiple 500 errors on /rpc/athletes/list. Signup/login forms don't use Zod or React Hook Form as required."
  severity: blocker
  test: 1
  root_cause: "Multiple issues: (1) Frontend never calls setCurrentOrgSlug() to sync Better-Auth active org with API client headers - causes 500 errors. (2) Auth forms use inline validation instead of zodResolver with Zod schemas from contracts."
  artifacts:
    - path: "apps/coach-web/src/lib/api-client.ts"
      issue: "setCurrentOrgSlug() never called - org header not set"
    - path: "apps/coach-web/src/features/auth/components/signup-form.tsx"
      issue: "Uses inline validation instead of zodResolver"
  missing:
    - "Sync useActiveOrganization() with setCurrentOrgSlug() in authenticated layout"
    - "Create auth schemas in @strenly/contracts with zodResolver"
  debug_session: ".planning/debug/athletes-list-500-error.md"

- truth: "User can log in and the user menu dropdown works correctly"
  status: failed
  reason: "User reported: Can't log out. Clicking chip causes error: Base UI MenuGroupRootContext is missing. Menu group parts must be used within <Menu.Group>. Forms don't follow /form skill pattern."
  severity: blocker
  test: 2
  root_cause: "DropdownMenuLabel component used outside of DropdownMenuGroup in user-menu.tsx. Base UI MenuPrimitive.GroupLabel requires MenuGroupRootContext which is only provided by wrapping in MenuPrimitive.Group."
  artifacts:
    - path: "apps/coach-web/src/components/layout/user-menu.tsx"
      issue: "User info label (lines 53-58) not wrapped in DropdownMenuGroup"
  missing:
    - "Wrap DropdownMenuLabel with DropdownMenuGroup"
  debug_session: ".planning/debug/resolved/user-menu-crash.md"

- truth: "Dashboard stat cards show actual counts from data"
  status: failed
  reason: "User reported: Shows three cards but queries throw Internal Server Error so they have no data"
  severity: major
  test: 3
  root_cause: "Same as test 1 - frontend never sets X-Organization-Slug header because setCurrentOrgSlug() is never called with active org data."
  artifacts:
    - path: "apps/coach-web/src/lib/api-client.ts"
      issue: "currentOrgSlug never initialized"
  missing:
    - "Sync useActiveOrganization() with setCurrentOrgSlug() in authenticated layout"
  debug_session: ".planning/debug/athletes-list-500-error.md"

- truth: "Browse Exercises link navigates to working /exercises page"
  status: failed
  reason: "User reported: Exercises page crashes with error: DataTable components must be used within DataTable.Root"
  severity: blocker
  test: 4
  root_cause: "DataTable compound component pattern incomplete. ExercisesTable returns DataTable.Root without children. DataTablePagination rendered as sibling OUTSIDE the context provider instead of as child."
  artifacts:
    - path: "apps/coach-web/src/features/exercises/components/exercises-table.tsx"
      issue: "Returns DataTable.Root without children (lines 68-78)"
    - path: "apps/coach-web/src/features/exercises/views/exercises-browser-view.tsx"
      issue: "DataTablePagination rendered outside DataTable.Root (line 69)"
  missing:
    - "Restructure so DataTablePagination is child of DataTable.Root"
  debug_session: ".planning/debug/exercises-page-datatable-crash.md"

- truth: "Theme toggle exists in user menu with Light/Dark/System options"
  status: false_alarm
  reason: "User reported: No place to toggle the theme - feature is missing"
  severity: resolved
  test: 5
  root_cause: "FALSE ALARM - Theme toggle IS implemented and exists in user menu (lines 65-87 of user-menu.tsx). User couldn't see it because user menu crashes due to MenuGroupRootContext error (test 2). Once menu is fixed, theme toggle will be accessible."
  artifacts:
    - path: "apps/coach-web/src/lib/theme.tsx"
      issue: "Implementation complete - no issue"
    - path: "apps/coach-web/src/components/layout/user-menu.tsx"
      issue: "Theme submenu exists but blocked by menu crash"
  missing: []
  debug_session: ".planning/debug/resolved/theme-toggle-missing-user-menu.md"

- truth: "Athletes list loads and displays athlete data"
  status: failed
  reason: "User reported: Doesn't work - get error 500 when fetching"
  severity: blocker
  test: 7
  root_cause: "Same as test 1 - frontend never sets X-Organization-Slug header because setCurrentOrgSlug() is never called."
  artifacts:
    - path: "apps/coach-web/src/lib/api-client.ts"
      issue: "currentOrgSlug never initialized"
  missing:
    - "Sync useActiveOrganization() with setCurrentOrgSlug() in authenticated layout"
  debug_session: ".planning/debug/athletes-list-500-error.md"

- truth: "Create athlete form works with proper styling, validation messages, and saves successfully"
  status: failed
  reason: "User reported: Drawer styling bad (no padding, footer not at bottom). Default Zod error messages. Email marked optional but required. Can't save - 500 error 'Organization no encontrada', error mapping wrong."
  severity: blocker
  test: 8
  root_cause: "Multiple issues: (1) 500 error from missing org header (same as test 1). (2) Contract schemas lack custom error messages - shows default Zod text. (3) Sheet forms don't use SheetFooter for buttons. (4) SheetContent lacks content area padding."
  artifacts:
    - path: "packages/contracts/src/athletes/athlete.ts"
      issue: "Missing custom error messages on validation rules"
    - path: "apps/coach-web/src/features/athletes/views/athletes-list-view.tsx"
      issue: "Form buttons not in SheetFooter"
    - path: "apps/coach-web/src/components/ui/sheet.tsx"
      issue: "SheetContent missing content area padding"
  missing:
    - "Add custom error messages to contract Zod schemas"
    - "Move form buttons to SheetFooter"
    - "Add padding to Sheet content area"
  debug_session: ".planning/debug/forms-not-following-skill-pattern.md"

- truth: "Exercises browser displays table with exercise data"
  status: failed
  reason: "User reported: Exercises table doesn't work - crashes with DataTable.Root context error (same as test 4)"
  severity: blocker
  test: 11
  root_cause: "Same as test 4 - DataTable compound component pattern incomplete."
  artifacts:
    - path: "apps/coach-web/src/features/exercises/components/exercises-table.tsx"
      issue: "Returns DataTable.Root without children"
  missing:
    - "Restructure DataTable usage in exercises feature"
  debug_session: ".planning/debug/exercises-page-datatable-crash.md"

- truth: "User can log out via user menu"
  status: failed
  reason: "User reported: User chip not working - can't access user menu (same MenuGroupRootContext error as test 2)"
  severity: blocker
  test: 13
  root_cause: "Same as test 2 - DropdownMenuLabel not wrapped in DropdownMenuGroup."
  artifacts:
    - path: "apps/coach-web/src/components/layout/user-menu.tsx"
      issue: "Missing DropdownMenuGroup wrapper"
  missing:
    - "Fix user menu component"
  debug_session: ".planning/debug/resolved/user-menu-crash.md"
