---
phase: 02.5-coach-web-foundation
plan: 05
type: execute
wave: 3
depends_on: ["02.5-01", "02.5-02"]
files_modified:
  - apps/coach-web/src/routes/_authenticated/exercises.tsx
  - apps/coach-web/src/features/exercises/views/exercises-browser-view.tsx
  - apps/coach-web/src/features/exercises/components/exercises-table.tsx
  - apps/coach-web/src/features/exercises/components/exercise-filters.tsx
  - apps/coach-web/src/features/exercises/components/muscle-badges.tsx
  - apps/coach-web/src/features/exercises/hooks/queries/use-exercises.ts
  - apps/coach-web/src/features/exercises/hooks/queries/use-muscle-groups.ts
autonomous: true

must_haves:
  truths:
    - "Coach can view paginated list of exercises"
    - "Coach can search exercises by name"
    - "Coach can filter by muscle group"
    - "Coach can filter by movement pattern"
    - "Curated exercises show 'Curated' badge"
    - "Custom exercises show 'Custom' badge"
    - "Primary and secondary muscles display as badges"
  artifacts:
    - path: "apps/coach-web/src/features/exercises/views/exercises-browser-view.tsx"
      provides: "Exercises browser page"
      min_lines: 60
    - path: "apps/coach-web/src/features/exercises/components/exercises-table.tsx"
      provides: "Exercises DataTable with columns"
      min_lines: 50
    - path: "apps/coach-web/src/features/exercises/hooks/queries/use-exercises.ts"
      provides: "Exercises query hook"
      contains: "useQuery"
  key_links:
    - from: "apps/coach-web/src/features/exercises/hooks/queries/use-exercises.ts"
      to: "lib/api-client.ts"
      via: "orpc.exercises.list"
      pattern: "orpc\\.exercises\\.list"
    - from: "apps/coach-web/src/features/exercises/views/exercises-browser-view.tsx"
      to: "features/exercises/hooks/queries/use-exercises.ts"
      via: "useExercises hook"
      pattern: "useExercises"
---

<objective>
Create the exercise browser feature: list view with DataTable, filtering by muscle group and movement pattern.

Purpose: Coaches need to browse the exercise library to select exercises for programs.
Output: Exercise browser with search, filters, and clear visual distinction between curated/custom.
</objective>

<execution_context>
@/Users/tomiardz/.claude/get-shit-done/workflows/execute-plan.md
@/Users/tomiardz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/02.5-coach-web-foundation/02.5-CONTEXT.md
@.planning/phases/02.5-coach-web-foundation/02.5-RESEARCH.md
@.planning/phases/02.5-coach-web-foundation/02.5-02-SUMMARY.md
@packages/contracts/src/exercises/exercise.ts
@packages/contracts/src/exercises/muscle-group.ts
@apps/coach-web/src/lib/api-client.ts
@apps/coach-web/src/components/ui/badge.tsx
@apps/coach-web/src/components/ui/select.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create exercise query hooks</name>
  <files>
    apps/coach-web/src/features/exercises/hooks/queries/use-exercises.ts
    apps/coach-web/src/features/exercises/hooks/queries/use-muscle-groups.ts
  </files>
  <action>
Create the query hooks for exercises and muscle groups:

1. Create `features/exercises/hooks/queries/use-exercises.ts`:
   - Define exerciseKeys factory: all, list(filters), detail(id)
   - useExercises hook accepting ListExercisesInput
   - Use orpc.exercises.list.queryOptions({ input })
   - Return useQuery result

2. Create `features/exercises/hooks/queries/use-muscle-groups.ts`:
   - Define muscleGroupKeys factory: all
   - useMuscleGroups hook (no input needed)
   - Use orpc.exercises.muscleGroups.queryOptions({})
   - Return useQuery result
   - This provides the list of muscle groups for the filter dropdown

Pattern:
```typescript
export const exerciseKeys = {
  all: ['exercises'] as const,
  list: (filters: ListExercisesInput) => [...exerciseKeys.all, 'list', filters] as const,
  detail: (id: string) => [...exerciseKeys.all, 'detail', id] as const,
}

export function useExercises(input: ListExercisesInput) {
  return useQuery(orpc.exercises.list.queryOptions({ input }))
}
```
  </action>
  <verify>
Run `pnpm typecheck` to verify hooks compile correctly.
  </verify>
  <done>
Exercise and muscle group query hooks are created.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create exercise table and components</name>
  <files>
    apps/coach-web/src/features/exercises/components/exercises-table.tsx
    apps/coach-web/src/features/exercises/components/muscle-badges.tsx
    apps/coach-web/src/features/exercises/components/exercise-filters.tsx
  </files>
  <action>
Create the exercise table and filter components:

1. Create `features/exercises/components/muscle-badges.tsx`:
   - Component to display muscle groups as badges
   - Props: muscles (string[]), variant ('primary' | 'secondary')
   - Primary muscles: default badge variant
   - Secondary muscles: outline badge variant
   - Truncate if more than 3 muscles (show "+N more")

2. Create `features/exercises/components/exercise-filters.tsx`:
   - Filter dropdowns for muscle group and movement pattern
   - Muscle group: Select with options from useMuscleGroups
   - Movement pattern: Select with static options (push, pull, squat, hinge, lunge, carry, rotation)
   - Props: muscleGroup, movementPattern, onMuscleGroupChange, onMovementPatternChange
   - Include "All" option to clear filter
   - Render as flex row with gap

3. Create `features/exercises/components/exercises-table.tsx`:
   - Use DataTable compound component
   - Columns: Name, Muscles, Movement Pattern, Type, Actions
   - Name: exercise.name (bold)
   - Muscles: MuscleBadges showing primary + secondary
   - Movement Pattern: Capitalize and display or "-" if null
   - Type: Badge "Curated" (default) or "Custom" (secondary) based on isCurated
   - Actions: View details (future), Clone (if curated)
   - Props: data, totalCount, pageIndex, pageSize, onPageChange, isLoading

Columns:
```typescript
const columns: ColumnDef<Exercise>[] = [
  {
    accessorKey: 'name',
    header: 'Name',
    cell: ({ row }) => <span className="font-medium">{row.original.name}</span>,
  },
  {
    id: 'muscles',
    header: 'Muscles',
    cell: ({ row }) => (
      <div className="flex flex-wrap gap-1">
        <MuscleBadges muscles={row.original.primaryMuscles} variant="primary" />
        <MuscleBadges muscles={row.original.secondaryMuscles} variant="secondary" />
      </div>
    ),
  },
  {
    accessorKey: 'movementPattern',
    header: 'Pattern',
    cell: ({ row }) => row.original.movementPattern
      ? capitalize(row.original.movementPattern)
      : '-',
  },
  {
    id: 'type',
    header: 'Type',
    cell: ({ row }) => (
      <Badge variant={row.original.isCurated ? 'default' : 'secondary'}>
        {row.original.isCurated ? 'Curated' : 'Custom'}
      </Badge>
    ),
  },
]
```
  </action>
  <verify>
Import ExercisesTable with mock data and verify columns render correctly.
  </verify>
  <done>
Exercise table renders with all columns, muscle badges, and type indicators.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create exercises browser view</name>
  <files>
    apps/coach-web/src/features/exercises/views/exercises-browser-view.tsx
    apps/coach-web/src/routes/_authenticated/exercises.tsx
  </files>
  <action>
Create the exercises browser view:

1. Create `features/exercises/views/exercises-browser-view.tsx`:
   - State: search, muscleGroup, movementPattern, pageIndex, pageSize
   - Use useExercises hook with filters
   - Use useMuscleGroups for filter dropdown options
   - DataTable with Toolbar containing:
     - Search input (left)
     - ExerciseFilters (muscle group, movement pattern selects)
   - DataTable Content and Pagination
   - Reset page to 0 when filters change

2. Create thin route:
   - `routes/_authenticated/exercises.tsx`: createFileRoute, component: ExercisesBrowserView

View structure:
```typescript
export function ExercisesBrowserView() {
  const [search, setSearch] = useState('')
  const [muscleGroup, setMuscleGroup] = useState<MuscleGroup | undefined>()
  const [movementPattern, setMovementPattern] = useState<MovementPattern | undefined>()
  const [pageIndex, setPageIndex] = useState(0)
  const [pageSize, setPageSize] = useState(25) // Exercises default to 25 per page

  const { data, isLoading } = useExercises({
    search: search || undefined,
    muscleGroup,
    movementPattern,
    limit: pageSize,
    offset: pageIndex * pageSize,
  })

  // Reset page when filters change
  useEffect(() => {
    setPageIndex(0)
  }, [search, muscleGroup, movementPattern])

  return (
    <div className="space-y-4">
      <DataTable.Root {...tableProps}>
        <DataTable.Toolbar>
          <div className="flex items-center gap-4">
            <DataTable.Search value={search} onValueChange={setSearch} placeholder="Search exercises..." />
            <ExerciseFilters
              muscleGroup={muscleGroup}
              movementPattern={movementPattern}
              onMuscleGroupChange={setMuscleGroup}
              onMovementPatternChange={setMovementPattern}
            />
          </div>
        </DataTable.Toolbar>
        <DataTable.Content />
        <DataTable.Pagination />
      </DataTable.Root>
    </div>
  )
}
```
  </action>
  <verify>
Navigate to /exercises route and verify the list loads with filters working.
  </verify>
  <done>
Exercises browser displays data, search and filters work correctly.
  </done>
</task>

</tasks>

<verification>
1. Run `pnpm typecheck` - no errors
2. Run `pnpm lint` - no errors
3. Navigate to /exercises
4. Verify list loads with pagination (25 per page)
5. Verify search filters by name
6. Verify muscle group dropdown filters correctly
7. Verify movement pattern dropdown filters correctly
8. Verify curated exercises show "Curated" badge
9. Verify custom exercises show "Custom" badge
10. Verify muscle badges display primary and secondary muscles
</verification>

<success_criteria>
- Exercises list loads with pagination (25 per page default)
- Search debounces and filters exercises by name
- Muscle group dropdown shows all muscle groups from API
- Movement pattern dropdown shows all patterns
- Filters can be combined (search + muscle + pattern)
- Curated/Custom badge displays correctly
- Primary muscles show as default badges
- Secondary muscles show as outline badges
- Muscle overflow shows "+N more" when >3
- Page resets to 0 when filters change
- No TypeScript or lint errors
</success_criteria>

<output>
After completion, create `.planning/phases/02.5-coach-web-foundation/02.5-05-SUMMARY.md`
</output>
