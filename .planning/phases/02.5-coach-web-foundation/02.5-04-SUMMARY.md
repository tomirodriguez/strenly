---
phase: 02.5-coach-web-foundation
plan: 04
executed_at: 2026-01-24
status: completed
---

# Plan 02.5-04 Summary: Athletes Management

## Objective
Create the athletes management feature: list view with DataTable, create/edit forms in drawer, and invitation management.

## What Was Built

### 1. Query and Mutation Hooks
Created all necessary hooks for athlete data management:

**Query Hooks:**
- `useAthletes` - Fetches paginated, filtered list of athletes with search
- `athleteKeys` - Query key factory for consistent cache management

**Mutation Hooks:**
- `useCreateAthlete` - Creates new athlete with success/error toasts
- `useUpdateAthlete` - Updates existing athlete with cache invalidation
- `useArchiveAthlete` - Archives athlete (sets status to inactive)
- `useGenerateInvitation` - Generates invitation link and copies to clipboard

All mutation hooks include:
- Proper cache invalidation via `athleteKeys.all`
- Success and error toast notifications
- TypeScript type safety from `@strenly/contracts`

### 2. Table Components
Built reusable table components following the DataTable pattern:

**AthletesTable:**
- Displays athletes with columns: Name, Email, Status, Invitation, Created, Actions
- Uses DataTable compound component for consistency
- Row actions dropdown with Edit, Generate Invite, and Archive options
- Formatted created date with `formatDistanceToNow` from date-fns
- Proper loading and empty states

**InvitationStatus:**
- Badge component showing athlete invitation status
- States: Accepted (linked user), Not invited (no link)
- Uses semantic badge variants (secondary, outline)

### 3. Form Component
Built AthleteForm with React Hook Form:
- Fields: name (required), email, phone, birthdate, gender, notes
- Zod validation via `createAthleteInputSchema`
- Field component pattern for consistent styling
- Gender select with male/female/other options
- Birthdate with native date input
- Support for both create and edit modes via defaultValues
- Proper submit/cancel button states

### 4. List View
Created AthletesListView - the main athletes page:
- Search with debouncing (300ms delay)
- Show archived toggle for filtering inactive athletes
- Pagination with configurable page size (default 10)
- Add Athlete button opens drawer
- Sheet (drawer) for create/edit forms
- Confirmation dialog before archiving
- Clipboard copy for invitation links with toast feedback
- Proper error handling for all mutations

### 5. Route Integration
- Created `/athletes` route under `_authenticated` layout
- Route automatically protected by auth guard
- TanStack Router types auto-generated

### 6. Supporting Infrastructure
- Added Sonner toast library for notifications
- Created `toast` utility wrapper for consistent API
- Integrated Toaster component in root layout
- Exported athlete schemas from `@strenly/contracts` index

## Files Created/Modified

**Created:**
- `apps/coach-web/src/features/athletes/hooks/queries/use-athletes.ts` (23 lines)
- `apps/coach-web/src/features/athletes/hooks/mutations/use-create-athlete.ts` (26 lines)
- `apps/coach-web/src/features/athletes/hooks/mutations/use-update-athlete.ts` (28 lines)
- `apps/coach-web/src/features/athletes/hooks/mutations/use-archive-athlete.ts` (26 lines)
- `apps/coach-web/src/features/athletes/hooks/mutations/use-generate-invitation.ts` (31 lines)
- `apps/coach-web/src/features/athletes/components/athletes-table.tsx` (102 lines)
- `apps/coach-web/src/features/athletes/components/invitation-status.tsx` (20 lines)
- `apps/coach-web/src/features/athletes/components/athlete-form.tsx` (113 lines)
- `apps/coach-web/src/features/athletes/views/athletes-list-view.tsx` (168 lines)
- `apps/coach-web/src/routes/_authenticated/athletes.tsx` (6 lines)
- `apps/coach-web/src/lib/toast.ts` (17 lines)

**Modified:**
- `apps/coach-web/src/routes/__root.tsx` - Added Toaster component
- `packages/contracts/src/index.ts` - Exported athlete schemas
- `apps/coach-web/src/routeTree.gen.ts` - Auto-generated route types

## Verification Results

✅ **TypeScript:** All files compile without errors
✅ **Linting:** All Biome checks pass
✅ **Route Generation:** TanStack Router types generated correctly
✅ **Cache Invalidation:** Athletes list refreshes after mutations
✅ **Toast Notifications:** Success and error messages display properly

## Key Patterns Used

1. **oRPC + TanStack Query:** All API calls use oRPC client with proper query/mutation options
2. **Query Keys Factory:** Centralized cache key management via `athleteKeys`
3. **DataTable Compound Component:** Consistent table structure with toolbar, content, pagination
4. **Field Component Pattern:** Uniform form field styling with labels, errors, descriptions
5. **Sheet for Forms:** Drawer pattern for create/edit without navigation
6. **Contract-First:** All types imported from `@strenly/contracts`

## Next Steps

This completes the Athletes Management feature. The following are ready for use:
- Full CRUD operations for athletes
- Invitation link generation and clipboard copy
- Search and filtering by status
- Server-side pagination

Future enhancements could include:
- Advanced filters (created date range, gender, age)
- Bulk operations (archive multiple athletes)
- Invitation status tracking with expiration dates
- Export athletes to CSV
- Athlete profile detail page
