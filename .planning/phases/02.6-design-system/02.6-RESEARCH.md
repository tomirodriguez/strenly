# Phase 2.6: Design System & Visual Refresh - Research

**Researched:** 2026-01-25
**Domain:** TailwindCSS 4 theming, shadcn/ui dark mode, CSS custom properties
**Confidence:** HIGH

## Summary

This phase transforms the coach web app visual identity from the current light/neutral theme to a dark slate color palette with blue primary accent. The project already has TailwindCSS 4.1.17 and shadcn/ui 3.6.3 installed with a working theme provider and CSS variables infrastructure.

The current CSS uses OKLCH color format with neutral grays (no hue). The target design requires slate colors (with subtle blue hue) and blue-600 (#2563eb) as the primary color. The existing `@custom-variant dark` directive and `@theme inline` pattern are already in place, but the CSS variables need to be updated to match the reference design.

The key technical approach is to update CSS custom properties in `index.css` to use the slate palette, change the primary color to blue, and then update the ThemeProvider to use the `.dark` class (matching the reference) instead of `data-theme` attribute. All existing components use CSS variables, so they will automatically adopt the new colors.

**Primary recommendation:** Update CSS variables to slate palette + blue primary, then refine layout components (sidebar, header) to match the reference design structure.

## Standard Stack

### Core (Already Installed)
| Library | Version | Purpose | Why Standard |
|---------|---------|---------|--------------|
| TailwindCSS | 4.1.17 | Utility-first CSS | Already in project, native CSS variable support |
| shadcn/ui | 3.6.3 | UI component primitives | Already in project, built on Base UI |
| @fontsource-variable/inter | latest | Font family | Already imported in index.css |

### Supporting (No New Dependencies Needed)
| Library | Version | Purpose | When to Use |
|---------|---------|---------|-------------|
| class-variance-authority | existing | Component variants | Already used in button, badge, sidebar |
| lucide-react | existing | Icons | Already used throughout |

### Alternatives Considered
| Instead of | Could Use | Tradeoff |
|------------|-----------|----------|
| CSS variables | Tailwind config | CSS vars allow runtime theming, config is build-time only |
| `.dark` class | `data-theme` attr | `.dark` is shadcn/ui standard, easier integration |
| OKLCH colors | HSL/RGB | OKLCH provides perceptually uniform lightness, better accessibility |

**Installation:** No new dependencies required.

## Architecture Patterns

### CSS Variables Structure (TailwindCSS 4 + shadcn/ui)

The project uses the shadcn/ui standard pattern with three layers:

```css
/* 1. Root variables - define actual color values */
:root {
  --background: oklch(0.97 0.01 255);  /* Light mode */
  --foreground: oklch(0.15 0.02 255);
}

.dark {
  --background: oklch(0.09 0.02 255);  /* Dark mode - slate-950 */
  --foreground: oklch(0.97 0.01 255);
}

/* 2. Theme inline - map to Tailwind utilities */
@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
}

/* 3. Base layer - apply defaults */
@layer base {
  body {
    @apply bg-background text-foreground;
  }
}
```

### Target Color Palette (Reference Design)

| Token | Light Mode | Dark Mode (Target) | Tailwind Equivalent |
|-------|------------|-------------------|---------------------|
| `--background` | white | `#0f172a` | slate-950 |
| `--card` / `--sidebar` | white | `#1e293b` | slate-900 |
| `--border` | gray-200 | `#334155` | slate-800 |
| `--muted` | gray-100 | `#1e293b` | slate-900 |
| `--muted-foreground` | gray-500 | `#94a3b8` | slate-400 |
| `--primary` | blue-600 | `#2563eb` | blue-600 |
| `--primary-foreground` | white | white | white |
| `--foreground` | gray-900 | white | white |

### OKLCH Values for Slate Palette

Source: Tailwind CSS default colors converted to OKLCH

```css
/* Dark mode slate values */
--slate-950: oklch(0.129 0.042 264.695);  /* #0f172a - background */
--slate-900: oklch(0.208 0.042 265.755);  /* #1e293b - surfaces */
--slate-800: oklch(0.279 0.041 264.532);  /* #334155 - borders */
--slate-700: oklch(0.372 0.044 257.287);  /* #475569 */
--slate-600: oklch(0.446 0.043 257.281);  /* #64748b */
--slate-500: oklch(0.554 0.046 257.417);  /* #94a3b8 */
--slate-400: oklch(0.704 0.040 256.788);  /* #cbd5e1 */
--slate-300: oklch(0.828 0.027 256.848);  /* #e2e8f0 */
--slate-200: oklch(0.929 0.013 255.508);  /* #f1f5f9 */
--slate-100: oklch(0.968 0.007 264.536);  /* #f8fafc */

/* Blue-600 primary */
--blue-600: oklch(0.546 0.245 262.881);   /* #2563eb */
```

### Theme Provider Pattern

Current implementation uses `data-theme` attribute. Should update to `.dark` class for shadcn/ui compatibility:

```typescript
// Update ThemeProvider to use .dark class
useEffect(() => {
  const resolved = resolveTheme(theme)
  setResolvedTheme(resolved)

  // Use .dark class (shadcn/ui standard)
  document.documentElement.classList.toggle('dark', resolved === 'dark')
}, [theme])
```

### Sidebar Layout Structure (Reference Design)

```
Sidebar (240px, fixed left)
+------------------------------------------+
| Logo + Brand Name (h-16, border-b)       |
+------------------------------------------+
| Nav Section (flex-1, overflow-y-auto)    |
|   - Dashboard (active: bg-primary)       |
|   - Athletes                             |
|   - Programs                             |
|   - Exercises                            |
|   - Templates                            |
|------------------------------------------|
|   SETTINGS label (uppercase, small)      |
|   - Settings                             |
|   - Help Center                          |
+------------------------------------------+
| User Profile (border-t, p-4)             |
|   Avatar | Name | Menu icon              |
+------------------------------------------+
```

### Header Layout Structure (Reference Design)

```
Header (h-16, sticky top-0)
+----------------------------------------------------------+
| Breadcrumb (Strenly > Overview)  |  Search | Bell | CTA  |
+----------------------------------------------------------+
```

### Anti-Patterns to Avoid

- **Hardcoding colors:** Never use `bg-slate-900` directly in components. Use semantic tokens like `bg-card` or `bg-sidebar`.
- **Mixing color formats:** Stick with OKLCH throughout for consistency.
- **Forgetting foreground pairs:** Every background color needs a matching foreground for text contrast.
- **Overriding CSS variables in components:** Let the global theme handle colors, components use tokens.

## Don't Hand-Roll

| Problem | Don't Build | Use Instead | Why |
|---------|-------------|-------------|-----|
| Dark mode toggle | Custom class toggle | `.dark` class + ThemeProvider | shadcn/ui standard, CSS vars work automatically |
| Color conversion | Manual hex-to-oklch | Tailwind's default OKLCH values | Perceptually accurate, tested |
| Active nav state styling | Custom active classes | SidebarMenuButton `isActive` + CSS vars | Built-in state management |
| Sidebar collapse | Custom collapse logic | shadcn/ui Sidebar `collapsible` prop | Animation and state handled |
| Breadcrumb generation | Manual path parsing | TanStack Router matches | Type-safe, automatic |

**Key insight:** The existing shadcn/ui components already support all the styling needs through CSS variables. The work is updating variable values, not component logic.

## Common Pitfalls

### Pitfall 1: Forgetting the `.dark` Class Selector Update
**What goes wrong:** Dark mode styles don't apply even after updating CSS variables.
**Why it happens:** Current ThemeProvider uses `data-theme` attribute but CSS uses `.dark` class selector.
**How to avoid:** Update ThemeProvider to toggle `.dark` class AND update `@custom-variant dark` if using different selector.
**Warning signs:** Light mode works, dark mode shows light colors.

### Pitfall 2: OKLCH Alpha Syntax Differences
**What goes wrong:** Colors with opacity don't work (e.g., borders, overlays).
**Why it happens:** OKLCH alpha uses `/` syntax: `oklch(0.5 0.1 200 / 50%)` not `oklch(0.5 0.1 200 0.5)`.
**How to avoid:** Use the correct format: `oklch(L C H / alpha%)`.
**Warning signs:** Borders or overlays appear solid instead of translucent.

### Pitfall 3: Sidebar Border vs Background Confusion
**What goes wrong:** Sidebar looks "flat" without visual separation.
**Why it happens:** Reference design uses subtle borders, not background differences alone.
**How to avoid:** Apply `border-r border-slate-800` to sidebar, not just background color.
**Warning signs:** Sidebar blends into content area.

### Pitfall 4: Primary Color on Dark Background Legibility
**What goes wrong:** Blue-600 text is hard to read on slate-950 background.
**Why it happens:** Blue-600 is designed for light backgrounds.
**How to avoid:** Use blue-600 for backgrounds/buttons, use lighter blues (blue-400/500) for text on dark.
**Warning signs:** Contrast ratio below 4.5:1.

### Pitfall 5: Forgetting Sidebar-Specific Variables
**What goes wrong:** Sidebar doesn't theme correctly, uses wrong colors.
**Why it happens:** shadcn/ui sidebar has its own CSS variable set (`--sidebar`, `--sidebar-foreground`, etc.).
**How to avoid:** Update ALL sidebar-prefixed variables, not just core variables.
**Warning signs:** Sidebar uses different colors than expected.

## Code Examples

### CSS Variables Update (Dark Mode Focus)

```css
/* Source: Reference design analysis + Tailwind OKLCH values */
.dark {
  /* Core surfaces */
  --background: oklch(0.129 0.042 264.695);      /* slate-950 #0f172a */
  --foreground: oklch(0.985 0 0);                 /* white */

  /* Cards and elevated surfaces */
  --card: oklch(0.208 0.042 265.755);            /* slate-900 #1e293b */
  --card-foreground: oklch(0.985 0 0);
  --popover: oklch(0.208 0.042 265.755);         /* slate-900 */
  --popover-foreground: oklch(0.985 0 0);

  /* Primary action color - blue */
  --primary: oklch(0.546 0.245 262.881);         /* blue-600 #2563eb */
  --primary-foreground: oklch(0.985 0 0);        /* white */

  /* Secondary/muted elements */
  --secondary: oklch(0.279 0.041 264.532);       /* slate-800 */
  --secondary-foreground: oklch(0.985 0 0);
  --muted: oklch(0.208 0.042 265.755);           /* slate-900 */
  --muted-foreground: oklch(0.554 0.046 257.417); /* slate-500 #94a3b8 */

  /* Accent for hover states */
  --accent: oklch(0.279 0.041 264.532);          /* slate-800 */
  --accent-foreground: oklch(0.985 0 0);

  /* Borders and inputs */
  --border: oklch(0.279 0.041 264.532);          /* slate-800 #334155 */
  --input: oklch(0.279 0.041 264.532);
  --ring: oklch(0.546 0.245 262.881);            /* blue-600 for focus */

  /* Sidebar-specific */
  --sidebar: oklch(0.129 0.042 264.695);         /* slate-950 */
  --sidebar-foreground: oklch(0.985 0 0);
  --sidebar-primary: oklch(0.546 0.245 262.881); /* blue-600 */
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.279 0.041 264.532);  /* slate-800 */
  --sidebar-accent-foreground: oklch(0.985 0 0);
  --sidebar-border: oklch(0.279 0.041 264.532);  /* slate-800 */
  --sidebar-ring: oklch(0.546 0.245 262.881);
}
```

### Updated ThemeProvider (Class-Based)

```typescript
// Source: TailwindCSS dark mode docs + shadcn/ui pattern
export function ThemeProvider({ children }: { children: ReactNode }) {
  const [theme, setThemeState] = useState<Theme>(() => {
    const stored = localStorage.getItem('theme')
    if (stored === 'light' || stored === 'dark' || stored === 'system') {
      return stored
    }
    return 'dark' // Default to dark for this app
  })

  useEffect(() => {
    const resolved = resolveTheme(theme)

    // Update .dark class on html element (shadcn/ui standard)
    document.documentElement.classList.toggle('dark', resolved === 'dark')
  }, [theme])

  // ... rest of implementation
}
```

### Sidebar with User Profile Footer

```tsx
// Source: Reference design HTML analysis
export function AppSidebar() {
  return (
    <Sidebar collapsible="offExamples" className="border-r border-sidebar-border">
      <SidebarHeader className="h-16 border-b border-sidebar-border">
        <div className="flex items-center gap-2 px-4">
          <div className="flex size-8 items-center justify-center rounded-md bg-primary">
            <ZapIcon className="size-4 text-primary-foreground" />
          </div>
          <span className="font-bold text-xl tracking-tight">STRENLY</span>
        </div>
      </SidebarHeader>

      <SidebarContent>
        <SidebarGroup>
          <SidebarGroupContent>
            <SidebarMenu>
              {mainNavItems.map((item) => (
                <SidebarMenuItem key={item.path}>
                  <SidebarMenuButton isActive={isActive(item.path)}>
                    <item.icon />
                    <span>{item.label}</span>
                  </SidebarMenuButton>
                </SidebarMenuItem>
              ))}
            </SidebarMenu>
          </SidebarGroupContent>
        </SidebarGroup>

        <SidebarGroup>
          <SidebarGroupLabel className="text-[10px] font-bold uppercase tracking-widest text-muted-foreground">
            Settings
          </SidebarGroupLabel>
          <SidebarGroupContent>
            <SidebarMenu>
              {settingsNavItems.map((item) => (
                <SidebarMenuItem key={item.path}>
                  <SidebarMenuButton>
                    <item.icon />
                    <span>{item.label}</span>
                  </SidebarMenuButton>
                </SidebarMenuItem>
              ))}
            </SidebarMenu>
          </SidebarGroupContent>
        </SidebarGroup>
      </SidebarContent>

      <SidebarFooter className="border-t border-sidebar-border bg-sidebar/50">
        <UserProfileFooter user={user} />
      </SidebarFooter>
    </Sidebar>
  )
}
```

### Header with Breadcrumb and Actions

```tsx
// Source: Reference design HTML analysis
export function AppHeader({ primaryAction }: { primaryAction?: { label: string; onClick: () => void } }) {
  return (
    <header className="sticky top-0 z-40 flex h-16 items-center justify-between border-b border-border bg-background/80 px-8 backdrop-blur-md">
      <div className="flex flex-col">
        <Breadcrumbs />
      </div>

      <div className="flex items-center gap-4">
        <Button variant="ghost" size="icon">
          <SearchIcon className="size-5 text-muted-foreground" />
        </Button>
        <Button variant="ghost" size="icon">
          <BellIcon className="size-5 text-muted-foreground" />
        </Button>

        <Separator orientation="vertical" className="mx-2 h-6" />

        {primaryAction && (
          <Button onClick={primaryAction.onClick}>
            <PlusIcon className="size-4" />
            {primaryAction.label}
          </Button>
        )}
      </div>
    </header>
  )
}
```

### Active Nav Item Styling

```css
/* The SidebarMenuButton already supports active state via isActive prop */
/* Active items should use primary color background */
.nav-active {
  @apply bg-primary text-primary-foreground font-medium;
}

/* In the sidebar component variant, update the active state styling */
/* Current: data-active:bg-sidebar-accent data-active:text-sidebar-accent-foreground */
/* Target:  data-active:bg-sidebar-primary data-active:text-sidebar-primary-foreground */
```

## State of the Art

| Old Approach | Current Approach | When Changed | Impact |
|--------------|------------------|--------------|--------|
| HSL color values | OKLCH color values | Tailwind v4 / shadcn late 2024 | Perceptually uniform colors, better accessibility |
| `@layer base` for CSS vars | Root-level `:root` and `.dark` | Tailwind v4 | Variables work with `@theme inline` |
| `tailwind.config.js` | CSS-first config with `@theme` | Tailwind v4 | Simpler setup, better CSS var support |
| data attributes for theme | `.dark` class | shadcn/ui standard | Wider ecosystem compatibility |

**Deprecated/outdated:**
- `tailwind.config.js` theme extension: Still works but prefer CSS-based configuration
- HSL color format in CSS vars: Use OKLCH for better color space handling
- Wrapping vars in `hsl()`: With `@theme inline`, values should include the function

## Open Questions

1. **Coach Web Only vs Shared Tokens**
   - What we know: Phase scope is coach-web only
   - What's unclear: Should design tokens be in a shared package for athlete-pwa later?
   - Recommendation: Keep in coach-web for now, extract to shared package in future phase if needed

2. **Light Mode Support**
   - What we know: Reference design is dark-only, current app has theme toggle
   - What's unclear: Should we maintain light mode or go dark-only?
   - Recommendation: Maintain light mode variables for future flexibility, default to dark

3. **Sidebar Active State Color**
   - What we know: Reference uses solid blue (bg-primary) for active nav
   - What's unclear: Current shadcn sidebar uses accent color for active, which is subtle
   - Recommendation: Override sidebar-primary to use blue-600 for active nav items

## Sources

### Primary (HIGH confidence)
- [TailwindCSS Dark Mode Docs](https://tailwindcss.com/docs/dark-mode) - @custom-variant usage, class strategy
- [TailwindCSS Theme Variables](https://tailwindcss.com/docs/theme) - @theme directive, @theme inline
- [shadcn/ui Theming](https://ui.shadcn.com/docs/theming) - CSS variable structure, color conventions
- [shadcn/ui Tailwind v4](https://ui.shadcn.com/docs/tailwind-v4) - OKLCH migration, @theme inline pattern
- Reference design: `docs/ux-ui/dashboard-look-and-feel.html` - Exact colors and layout structure

### Secondary (MEDIUM confidence)
- Codebase analysis of existing components in `apps/coach-web/src/components/ui/`
- Current `index.css` structure with OKLCH values

### Tertiary (LOW confidence)
- None - all findings verified with official documentation

## Metadata

**Confidence breakdown:**
- Standard stack: HIGH - No new dependencies, verified existing versions
- Architecture: HIGH - Based on official TailwindCSS v4 and shadcn/ui docs
- Pitfalls: HIGH - Derived from official docs and reference design analysis

**Research date:** 2026-01-25
**Valid until:** 60 days (stable technologies, no rapid changes expected)
